import{a as I,d as M}from"../../../resources/global/global.util.CdGU-cda.js";import{r as g}from"../../../stores/request.server.Jl9Oinz8.js";import{G as O}from"./api/header/GlobalRequestHeader.A6HxmQBd.js";import{a as w,A as B}from"./util/request.utils.C-Y0rqBy.js";import{_ as F}from"../../../components/address/S3Address.C-l0MtE3.js";import{s as z}from"../../../pinia.C4zkjZtA.js";import{a as b,l as p,e as s,w as i,F as P,r as n,o as c,c as _,t as u,f as y}from"../../../vue.B9VI7CMM.js";import"../../../js.DlQi3gKf.js";import"../../../md5.DCeuUgf6.js";import"../../../charenc.DHEmDxqN.js";import"../../../resources/util/map.DsJxN4sz.js";import"../../../resources/util/cache.indexeddb.CXuVJu8M.js";import"../../../resources/util/timer.util.DJ34cZ81.js";import"./api/detail/Header.BZcc_YOh.js";import"../../../resources/util/snowflake.util.CMOmz3k-.js";import"../../../resources/util/machine.code.util.H1Gamunq.js";import"../../../resources/util/crypto.util.De05Bpu1.js";import"../../../crypto.tqJ8oQci.js";import"../../../antlr4.BZgrZd6q.js";import"../../../../../public.scmp.config.js";import"../../../mitt.C1xD_ZTF.js";const j={name:"ShareIndex",components:{GlobalRequestHeader:O},setup(){const{reset:e}=g(),{isShare:t,selectEntityId:a,entityMap:d,domainOptions:o,apiDocDetail:l}=z(g());return{isShare:t,selectEntityId:a,entityMap:d,domainOptions:o,apiDocDetail:l,reset:e}},emits:[],props:{},data(){return{activeName:w,showGlobalHeader:!1,treeProps:{children:"children",isLeaf:e=>e.type==="api",label:"title"},showTooltip:!1,tooltipRef:void 0,tooltipData:{},showTooltipDebounce:M((e,t)=>{if(!e||!(t.title||t.name))return this.showTooltip=!1;this.tooltipRef=e,this.tooltipData=t,this.showTooltip=!0},.3)}},computed:{flag(){return this.$route.query.id}},watch:{},created(){this.reset(),this.isShare=!0;const e=I(this.flag,"base64").split(",");Promise.all([this.findAll("tb_request_api.find",{ids:e}),this.findOne("tb_api_docs.find",{flag:this.flag}),this.findOne("tb_config.findAll",{key:"requestEnvConfig"})]).then(([t,a,d])=>{var o;this.selectEntityId=(o=t.data[0])==null?void 0:o.id,t.data.forEach(l=>this.entityMap.put(l.id,l)),this.apiDocDetail=a.data.id?a.data:{api_ids:e,flag:this.flag},this.apiDocDetail.children=t.data,this.domainOptions=d.data.value})},mounted(){},methods:{apiDocTreeNodeOnMouseover(e,t){this.showTooltipDebounce(e.currentTarget.parentElement,t)},handleCommand(e){e==="globalRequestHeader"&&(this.showGlobalHeader=!0)},docNodeClick(e,t,a,d){if(!e)return;const o=e.type==="api";this.jumpRoute(o?w:B),o&&(this.selectEntityId=e.id)},jumpRoute(e){this.$route.name.endsWith(e)||this.$router.push({name:this.$route.meta.name+e,query:this.$route.query})}}},U={class:"layout"},L=["onMouseenter"],W=["data-text"],J={class:"tree-node-text"},K={class:"wrapper-content"},Q={style:{"white-space":"break-spaces"}};function X(e,t,a,d,o,l){const D=n("Folder"),v=n("Document"),h=n("el-icon"),k=n("el-text"),x=n("s3-tree"),N=n("s3-drag-line"),q=n("s3-scroll"),C=n("router-view"),T=n("Setting"),H=n("el-dropdown-item"),R=n("el-dropdown-menu"),G=n("el-dropdown"),V=n("s3-draggable"),E=n("el-tooltip"),S=n("global-request-header"),A=n("s3-dialog");return c(),b(P,null,[p("div",U,[s(q,{class:"api-doc-tree"},{scrollBottom:i(()=>[s(N,{"z-index":2,position:"right"})]),default:i(()=>[s(x,{class:"tree-detail","node-key":"id","highlight-current":"","default-expand-all":"","expand-on-click-node":!1,"current-node-key":d.selectEntityId,props:o.treeProps,data:[this.apiDocDetail],onNodeClick:l.docNodeClick},{default:i(({node:m,data:r})=>[p("div",{class:"node-item",onMouseenter:f=>l.apiDocTreeNodeOnMouseover(f,r),onMouseleave:t[0]||(t[0]=f=>o.showTooltipDebounce())},[r.type==="api"?(c(),b("span",{key:0,class:"api-method","data-text":r.config.method},u(r.config.method),9,W)):(c(),_(h,{key:1,class:"doc-icon"},{default:i(()=>[r.type==="folder"?(c(),_(D,{key:0})):(c(),_(v,{key:1}))]),_:2},1024)),p("div",J,[s(k,{class:"tree-node-text-wrapper",truncated:""},{default:i(()=>[y(u(r.title||r.name),1)]),_:2},1024)])],40,L)]),_:1},8,["current-node-key","props","data","onNodeClick"])]),_:1}),p("div",K,[s(C)]),s(V,{class:"setting-config"},{default:i(()=>[s(G,{trigger:"click",onCommand:l.handleCommand},{dropdown:i(()=>[s(R,null,{default:i(()=>[s(H,{command:"globalRequestHeader"},{default:i(()=>[y("全局请求头管理")]),_:1})]),_:1})]),default:i(()=>[s(h,{size:30},{default:i(()=>[s(T)]),_:1})]),_:1},8,["onCommand"])]),_:1})]),s(E,{visible:o.showTooltip,"virtual-ref":o.tooltipRef,placement:"right",effect:"customized"},{content:i(()=>[p("span",Q,u(o.tooltipData.title||o.tooltipData.desc||o.tooltipData.name),1)]),_:1},8,["visible","virtual-ref"]),s(A,{modelValue:o.showGlobalHeader,"onUpdate:modelValue":t[2]||(t[2]=m=>o.showGlobalHeader=m),title:"Global Request Header Config"},{default:i(()=>[s(S,{modelValue:o.showGlobalHeader,"onUpdate:modelValue":t[1]||(t[1]=m=>o.showGlobalHeader=m)},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}const we=F(j,[["render",X],["__scopeId","data-v-077a8b06"]]);export{we as default};
