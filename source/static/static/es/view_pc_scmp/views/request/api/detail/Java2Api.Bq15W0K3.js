import{V as _,c as D,w as h,r as f,o as w,l as g,e as m,f as j,ac as S,ad as C}from"../../../../../.store.ssRjOe-B.js";import{J as b}from"../../../../../resources/antlr4/java8/Java8Lexer.B8YN2h1p.js";import{J as k}from"../../../../../resources/antlr4/java8/Java8Parser.CxsTCjtU.js";import{s as v}from"../../../../../resources/util/snowflake.util.BS7FKuq4.js";import{J as T}from"../../../../../resources/antlr4/java8/impl/java8.listener.B3BAfUTP.js";import{M as y}from"../../../../../resources/util/map.DsJxN4sz.js";import{s as V}from"../../../../../resources/global/global.util.BDToHPEB.js";import{_ as J}from"../../../../../components/address/S3Address.Dp8cFelg.js";const A={name:"Java2Api",components:{},setup(){return{}},emits:["update:modelValue","analysisSuccess"],props:{modelValue:{type:Boolean,default:!1},javaContent:{type:Object,default:void 0}},data(){return{javaTypeMapping:{int:"Number",double:"Number",boolean:"Boolean",MultipartFile:"File"},javaSource:new y,classDetail:new y,fieldDetail:new y,loading:!1}},computed:{modelValue_:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},javaSource_(){if(!this.javaSource.isEmpty())return"```java\n"+this.javaSource.values().join(`

//================分割线==================

`)+"\n```"}},watch:{},created(){this.javaContent&&this.javaSource.putAll(this.javaContent)},mounted(){},methods:{onPaste(e){const s=e.clipboardData||window.clipboardData,{items:[{kind:i}],files:[t]}=s;if(i==="file")return e.preventDefault(),t.name.endsWith(".java")?this.$refs.uploadFile.handleStart(t):this.$message({type:"error",showClose:!0,message:"仅支持Java文件",center:!0})},onClosed(){this.javaSource.clear()},fileRemove(e,s){this.javaSource.remove(e.name)},fileChange(e,s){if(!e.raw)return;const i=new FileReader;new Promise(t=>i.onload=l=>t(l.target.result)).then(t=>this.javaSource.put(e.name,t)),i.readAsText(e.raw)},analysisJavaSource(){this.loading=!0,V(.1).then(()=>{try{this.javaSource.forEach((t,l)=>this.analysis(l));const e=this.fieldDetail.keys()[0],s=this.fieldDetail.get(e),i=this.deepClassType(s,0,[e]);this.$emit("analysisSuccess",i),this.modelValue_=!1,this.javaSource.clear(),this.classDetail.clear(),this.fieldDetail.clear()}catch(e){this.$message({message:"解析失败:"+e,type:"error"})}finally{this.loading=!1}})},analysis(e){if(!e)return;const s=new _.InputStream(e),i=new b(s),t=new _.CommonTokenStream(i),a=new k(t).compilationUnit(),o=new T;_.tree.ParseTreeWalker.DEFAULT.walk(o,a);const{fieldDetail:r,classDetail:d}=o;this.fieldDetail.putAll(r),this.classDetail.putAll(d)},deepTypeChild(e,s,i,t=[]){let l,a,o,r,d,u;if(s.length===1?l=s[0]:s.length===2&&([l,o]=s,o.length===1?(d="List",a=o[0]):o.length===2&&(d="Object",a=o[1])),t.includes(l)||t.includes(a))return{fieldType:"Object"};if(this.fieldDetail.contains(l)&&t.push(l),this.fieldDetail.contains(a)&&t.push(a),a instanceof Array){const c=v(),n=this.deepTypeChild(e,a,c,t);a=n.fieldType,r=[{parentId:i,id:c,type:n.arrayType,desc:l,check:!0,children:n.children,index:0}]}if(this.fieldDetail.contains(a)){const c=v(),n=this.deepClassType(this.fieldDetail.get(a),c,t);r=[{parentId:i,id:c,type:"Object",desc:a,check:!0,children:n,index:0}],t.pop()}return this.fieldDetail.contains(l)&&(r=this.deepClassType(this.fieldDetail.get(l),v(),t),u={fieldType:"Object",children:r,arrayType:d},t.pop()),u||(l=this.javaTypeMapping[l]||d||l,{fieldType:l,children:r,arrayType:d})},deepClassType(e=[],s,i=[]){return e.map(({type:t,name:l,annotation:a})=>{const o=v(),{fieldType:r,children:d}=this.deepTypeChild(l,t,o,i);let u=!0,c;if(a&&a.ApiModelProperty){const n=a.ApiModelProperty;if(typeof n=="string")c=n;else if(typeof n=="object"){const p=n.required;u=p===void 0||p==="true",c=n.value}}return{parentId:s,id:o,key:l,type:r,desc:c,check:u,children:d}})}}},x=e=>(S("data-v-4bdf6506"),e=e(),C(),e),P={class:"java-document"},M=x(()=>g("div",{class:"el-upload__text"},[j("拖拽、粘贴Java文件或者"),g("em",null,"点击上传")],-1));function F(e,s,i,t,l,a){const o=f("upload-filled"),r=f("el-icon"),d=f("el-upload"),u=f("s3-doc"),c=f("el-button"),n=f("s3-dialog");return w(),D(n,{modelValue:a.modelValue_,"onUpdate:modelValue":s[1]||(s[1]=p=>a.modelValue_=p),title:"Analysis Java Document With Swagger",onClosed:a.onClosed,onPaste:a.onPaste},{footer:h(()=>[m(c,{onClick:a.analysisJavaSource,loading:l.loading},{default:h(()=>[j("解析")]),_:1},8,["onClick","loading"])]),default:h(()=>[g("div",P,[m(d,{class:"upload-file",ref:"uploadFile","on-change":a.fileChange,"on-remove":a.fileRemove,"auto-upload":!1,multiple:"",drag:"",accept:".java"},{default:h(()=>[m(r,{class:"el-icon--upload"},{default:h(()=>[m(o)]),_:1}),M]),_:1},8,["on-change","on-remove"]),m(u,{class:"java-source",content:a.javaSource_,"onUpdate:content":s[0]||(s[0]=p=>a.javaSource_=p)},null,8,["content"])])]),_:1},8,["modelValue","onClosed","onPaste"])}const W=J(A,[["render",F],["__scopeId","data-v-4bdf6506"]]);export{W as J};
