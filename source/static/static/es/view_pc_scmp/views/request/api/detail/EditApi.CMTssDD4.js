import{l as h}from"../../../../../resources/global/global.util.BDToHPEB.js";import{r as V}from"../../../../../stores/request.server.apbYzn03.js";import{_ as g}from"../../../../../components/address/S3Address.Dp8cFelg.js";import{c as _,w as b,r,o as m,e as a,a as x,d as P,F as E}from"../../../../../.store.ssRjOe-B.js";const T={name:"EditApi",components:{},setup(){const{refreshApiTree:o}=V();return{refreshApiTree:o}},emits:["update:modelValue"],props:{modelValue:{type:Boolean,default:!1},model:{type:Object,default:()=>({})}},data(){return{typeOptions:[{label:"folder",name:"目录"},{label:"api",name:"API"}],methodOptions:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}],cascaderProps:{value:"id",label:"name",checkStrictly:!0,emitPath:!1,lazy:!0,lazyLoad:this.findByParentId,leaf:(o,e)=>o.type==="api",disabled:(o,e)=>o.type==="api"}}},computed:{showForm:{get(){return this.modelValue},set(o,e){this.$emit("update:modelValue",o)}},entity(){return this.model},rules(){const o={type:[{required:!0,message:"请选择类型"}],name:[{required:!0,message:"请输入名称"}],"config.contextPath":[{required:!0,message:"请输入server.servlet.context-path"}]};return this.entity.type==="api"&&(o["config.method"]=[{required:!0,message:"请设置请求方法"}],o["config.url"]=[{required:!0,message:"请设置请求路径"}]),o}},watch:{},created(){},mounted(){},methods:{findByParentId(o,e){if(o.level===0&&(this.entity.id||this.entity.parent_id)){const n=[this.entity.id,this.entity.parent_id].filter(Boolean);this.findAll("tb_request_api.findTreeByIdIn",{ids:n}).then(d=>e(h(d.data,"id","parent_id")))}else this.findAll("tb_request_api.find",{parentId:o.data.id||0}).then(n=>e(n.data))},commit(){this.entity.parent_id===void 0&&(this.entity.parent_id=0),this.entity.search=[this.entity.name,this.entity.config.url].filter(Boolean).join(" "),(this.entity.id?this.update("tb_request_api.update",this.entity):this.save("tb_request_api.save",this.entity)).then(e=>{const n=this.entity.id?"更新成功":"新建成功";this.$message({type:"success",showClose:!0,message:n,center:!0}),this.refreshApiTree(this.entity),this.showForm=!1})}}};function v(o,e,n,d,s,t){const p=r("s3-form-radio"),u=r("s3-form-cascader"),i=r("s3-form-input"),f=r("s3-form-select"),y=r("s3-form-switch"),c=r("s3-dialog-form");return m(),_(c,{modelValue:t.showForm,"onUpdate:modelValue":e[9]||(e[9]=l=>t.showForm=l),model:t.entity,rules:t.rules,hideField:["type"],title:"新建/编辑",onConfirm:t.commit},{default:b(()=>[a(p,{label:"类型",prop:"type",modelValue:t.entity.type,"onUpdate:modelValue":e[0]||(e[0]=l=>t.entity.type=l),options:s.typeOptions},null,8,["modelValue","options"]),a(u,{label:"父级",prop:"parent_id",modelValue:t.entity.parent_id,"onUpdate:modelValue":e[1]||(e[1]=l=>t.entity.parent_id=l),props:s.cascaderProps},null,8,["modelValue","props"]),a(i,{label:"名称",prop:"name",modelValue:t.entity.name,"onUpdate:modelValue":e[2]||(e[2]=l=>t.entity.name=l),placeholder:"请输入名称"},null,8,["modelValue"]),a(i,{label:"描述",prop:"desc",modelValue:t.entity.desc,"onUpdate:modelValue":e[3]||(e[3]=l=>t.entity.desc=l),placeholder:"请输入描述",type:"textarea"},null,8,["modelValue"]),a(i,{label:"ContextPath",span:12,prop:"config.contextPath",modelValue:t.entity.config.contextPath,"onUpdate:modelValue":e[4]||(e[4]=l=>t.entity.config.contextPath=l),placeholder:"请输入server.servlet.context-path"},null,8,["modelValue"]),a(i,{label:"前缀",span:12,prop:"config.prefix",modelValue:t.entity.config.prefix,"onUpdate:modelValue":e[5]||(e[5]=l=>t.entity.config.prefix=l),placeholder:"请输入前缀"},null,8,["modelValue"]),t.entity.type==="api"?(m(),x(E,{key:0},[a(f,{label:"方法",span:7,prop:"config.method",modelValue:t.entity.config.method,"onUpdate:modelValue":e[6]||(e[6]=l=>t.entity.config.method=l),options:s.methodOptions},null,8,["modelValue","options"]),a(i,{label:"路径",span:12,prop:"config.url",modelValue:t.entity.config.url,"onUpdate:modelValue":e[7]||(e[7]=l=>t.entity.config.url=l),placeholder:"请输入路径"},null,8,["modelValue"]),a(y,{label:"SSE",span:5,prop:"config.sse",modelValue:t.entity.config.sse,"onUpdate:modelValue":e[8]||(e[8]=l=>t.entity.config.sse=l)},null,8,["modelValue"])],64)):P("",!0)]),_:1},8,["modelValue","model","rules","onConfirm"])}const A=g(T,[["render",v]]);export{A as E};
