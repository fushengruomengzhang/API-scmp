import{A as z}from"./detail/ApiTable.3WBV7yFb.js";import{i as H}from"../util/request.utils.C-Y0rqBy.js";import{J as I}from"./detail/Java2Api.DJKrZZe0.js";import{r as F}from"../../../../stores/request.server.Jl9Oinz8.js";import{s as N}from"../../../../pinia.C4zkjZtA.js";import{e as a,r as l,a as _,l as d,j as m,w as r,v as h,t as S,k as T,F as v,o as u,d as E,h as q,c as V,f as R}from"../../../../vue.B9VI7CMM.js";import{_ as O}from"../../../../components/address/S3Address.C-l0MtE3.js";const L={name:"ResponseDetail",components:{Java2Api:I,ApiTable:z},setup(){const s=F(),{getRunDetail:e}=s,{isShare:i,apiDetail:p}=N(F());return{isShare:i,apiDetail:p,getRunDetail:e,useRequestStore:s}},emits:[],props:{},data(){return{responseActive:"ResponseData",showDocument:!1,showView:!1,jsonView:void 0,analysisJavaDocument:!1,foldFlag:!0,jsonDeep:2,nextResponseActive:"ResponseData"}},computed:{responseDocument:{get(){return this.apiDetail.config.responseDocument||(this.apiDetail.config.responseDocument=[]),this.apiDetail.config.responseDocument},set(s){this.apiDetail.config.responseDocument=s}},runDetail(){return this.getRunDetail(this.apiDetail.id)},response(){var s;return(s=this.runDetail)==null?void 0:s.once},batchResponse(){var s;return(s=this.runDetail)==null?void 0:s.batch},isBatchResponse(){return this.responseActive.startsWith("bp_")},resDetail(){var p,n,o,f;const s=((n=(p=this.response)==null?void 0:p.ContentSize)==null?void 0:n.call(p))||"0B",e=((f=(o=this.response)==null?void 0:o.ResponseStatus)==null?void 0:f.call(o))||200,i=this.runDetail.time||"00:00:00 (0000000ms)";return[`Status:${e}`,`Time:${i}`,`Size:${s}`].join(" ")},batchIndex(){return this.isBatchResponse?Number(this.responseActive.slice(3)):0},responseData(){var s,e;return this.isBatchResponse?(s=this.batchResponse[this.batchIndex])==null?void 0:s.ResponseData:(e=this.response)==null?void 0:e.ResponseData},responseHeader(){var s,e;return this.isBatchResponse?(s=this.batchResponse[this.batchIndex])==null?void 0:s.ResponseHeader:(e=this.response)==null?void 0:e.ResponseHeader},tabActiveIsResData(){return this.isBatchResponse?this.nextResponseActive==="ResponseData":this.responseActive==="ResponseData"}},watch:{response(s,e){this.responseActive="ResponseData",this.foldFlag&&this.onFoldClick()},batchResponse(s,e){this.responseActive=s?"bp_0":"ResponseData",this.nextResponseActive="ResponseData",this.foldFlag&&this.onFoldClick()}},created(){},mounted(){const s=this.$refs.responseDetail.querySelector(".response-tabs > .el-tabs__header");s.prepend(this.$refs.responseFold),s.appendChild(this.$refs.responseFoldRight)},methods:{isDownload(s){if(s.key!=="download")return!1;const e=JSON.parse(s.content);return e.isDownload?(s._content=e,!0):!1},onTabClick(){this.foldFlag&&this.onFoldClick()},onDragEnd(){this.foldFlag&&(this.foldFlag=!this.foldFlag)},onFoldClick(){this.foldFlag=!this.foldFlag,this.$refs.responseDetail.style.height="auto",this.$refs.responseDetail.style.flex=this.foldFlag?"0 0 auto":"15 0 0"},updateResponseDocument(){this.update("tb_request_api.update",this.apiDetail).then(s=>this.$message({type:"success",showClose:!0,message:"更新完成",center:!0}))},headerCellRenderer(s){const e=()=>{let i=H(s,void 0,void 0,!0);s.length===1&&s[0].type==="List"&&!s[0].key&&(i=i[Object.keys(i)[0]]),this.jsonView=i,this.showView=!0};return a(l("el-button"),{icon:"View",size:"small",circle:!0,onClick:e},null)}}},M={class:"response-detail",ref:"responseDetail"},P={class:"response-detail-wrapper"},W={class:"show-document"},G={class:"res-data"},K=["href","download"],Q={class:"res-header"},X={class:"run-detail"};function Y(s,e,i,p,n,o){const f=l("s3-drag-line"),c=l("el-tab-pane"),k=l("el-tabs"),w=l("el-button"),b=l("s3-json"),j=l("api-table"),y=l("el-drawer"),x=l("Java2Api"),B=l("ArrowUp"),J=l("ArrowDown"),C=l("el-icon"),U=l("Minus");return u(),_(v,null,[d("div",M,[a(f,{"z-index":2,onDragEnd:o.onDragEnd},null,8,["onDragEnd"]),a(k,{modelValue:n.responseActive,"onUpdate:modelValue":e[1]||(e[1]=t=>n.responseActive=t),class:"response-tabs",onTabClick:o.onTabClick},{default:r(()=>[a(c,{label:"ResponseData",name:"ResponseData"}),a(c,{label:"ResponseHeader",name:"ResponseHeader"}),o.batchResponse&&o.batchResponse.length?(u(!0),_(v,{key:0},q(o.batchResponse,(t,g)=>{var A;return u(),V(c,{key:g,label:`结果${g+1}(${(A=t.ContentSize)==null?void 0:A.call(t,o.runDetail.time)})`,name:"bp_"+g},{default:r(()=>[a(k,{modelValue:n.nextResponseActive,"onUpdate:modelValue":e[0]||(e[0]=D=>n.nextResponseActive=D),class:"batch-res"},{default:r(()=>{var D;return[a(c,{label:`ResponseData(${(D=t.ResponseStatus)==null?void 0:D.call(t,o.runDetail.time)})`,name:"ResponseData"},null,8,["label"]),a(c,{label:"ResponseHeader",name:"ResponseHeader"})]}),_:2},1032,["modelValue"])]),_:2},1032,["label","name"])}),128)):E("",!0)]),_:1},8,["modelValue","onTabClick"]),d("div",P,[d("div",W,[a(w,{icon:"ArrowDown",class:"operation",text:"",type:"primary",size:"small",onClick:e[2]||(e[2]=t=>n.showDocument=!0)},{default:r(()=>[R("响应字段描述")]),_:1})]),m(d("div",G,[a(b,{class:"res-data-wrapper",modelValue:o.responseData,deep:n.jsonDeep},{value:r(t=>[o.isDownload(t)?(u(),_("a",{key:0,href:t._content.downloadUrl,download:t._content.fileName},"点我保存",8,K)):(u(),_(v,{key:1},[R(S(String(t.content)),1)],64))]),_:1},8,["modelValue","deep"])],512),[[h,o.tabActiveIsResData]]),m(d("div",Q,[a(b,{class:"res-header-wrapper",modelValue:o.responseHeader,deep:n.jsonDeep},null,8,["modelValue","deep"])],512),[[h,!o.tabActiveIsResData]])]),d("div",X,S(o.resDetail),1)],512),a(y,{modelValue:n.showDocument,"onUpdate:modelValue":e[5]||(e[5]=t=>n.showDocument=t),title:"Response Body Document Config",size:"70%"},T({default:r(()=>[a(j,{modelValue:o.responseDocument,"onUpdate:modelValue":e[3]||(e[3]=t=>o.responseDocument=t),"header-cell-renderer":o.headerCellRenderer},null,8,["modelValue","header-cell-renderer"])]),_:2},[!p.isShare&&p.apiDetail.id?{name:"footer",fn:r(()=>[a(w,{icon:"Pointer",type:"primary",onClick:e[4]||(e[4]=t=>n.analysisJavaDocument=!0)},{default:r(()=>[R("Analysis Java Document With Swagger")]),_:1}),a(w,{icon:"Edit",type:"primary",onClick:o.updateResponseDocument},{default:r(()=>[R("更新API")]),_:1},8,["onClick"])]),key:"0"}:void 0]),1032,["modelValue"]),a(y,{modelValue:n.showView,"onUpdate:modelValue":e[7]||(e[7]=t=>n.showView=t),title:"Response Body Document View",size:"50%"},{default:r(()=>[a(b,{modelValue:n.jsonView,"onUpdate:modelValue":e[6]||(e[6]=t=>n.jsonView=t),showLineNumber:"",showLength:"",showLine:"",showIcon:""},null,8,["modelValue"])]),_:1},8,["modelValue"]),a(x,{modelValue:n.analysisJavaDocument,"onUpdate:modelValue":e[8]||(e[8]=t=>n.analysisJavaDocument=t),onAnalysisSuccess:e[9]||(e[9]=t=>o.responseDocument=t)},null,8,["modelValue"]),m(d("div",{class:"response-fold response-fold-left el-tabs__item",ref:"responseFold",onClick:e[10]||(e[10]=(...t)=>o.onFoldClick&&o.onFoldClick(...t))},[a(C,null,{default:r(()=>[n.foldFlag?(u(),V(B,{key:0})):(u(),V(J,{key:1}))]),_:1})],512),[[h,!1]]),m(d("div",{class:"response-fold response-fold-right el-tabs__item",ref:"responseFoldRight",onClick:e[11]||(e[11]=(...t)=>o.onFoldClick&&o.onFoldClick(...t))},[m(a(C,null,{default:r(()=>[a(U)]),_:1},512),[[h,!n.foldFlag]])],512),[[h,!1]])],64)}const ae=O(L,[["render",Y],["__scopeId","data-v-78239ead"]]);export{ae as R};
