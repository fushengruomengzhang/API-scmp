import{A as L}from"./detail/ApiTable.gZ2cokSO.js";import{t as S}from"../util/request.utils.Cc8QJvHY.js";import{J as N}from"./detail/Java2Api.CojP8dLI.js";import{r as k}from"../../../../stores/request.server.OPoUfqQ8.js";import{s as H}from"../../../../pinia.DPawhP_y.js";import{e as n,r as i,a as h,l as u,j as D,w as l,v as f,t as y,k as I,F as v,o as p,h as T,c as V,f as w}from"../../../../vue.CpRb0aFL.js";import{_ as E}from"../../../../components/address/S3Address.BvGSUWFm.js";const z={name:"ResponseDetail",components:{Java2Api:N,ApiTable:L},setup(){const{getRunDetail:s}=k(),{isShare:e,apiDetail:r}=H(k());return{isShare:e,apiDetail:r,getRunDetail:s}},emits:[],props:{},data(){return{responseActive:"ResponseData",showDocument:!1,showView:!1,jsonView:void 0,analysisJavaDocument:!1,foldFlag:!0,jsonDeep:2,batchResponseActive:0,nextResponseActive:"ResponseData",emptyBatchResponse:[]}},computed:{responseDocument:{get(){return this.apiDetail.config.responseDocument||(this.apiDetail.config.responseDocument=[]),this.apiDetail.config.responseDocument},set(s){this.apiDetail.config.responseDocument=s}},response(){var s;return(s=this.getRunDetail(this.apiDetail.id))==null?void 0:s.once},batchResponse(){var s;return((s=this.getRunDetail(this.apiDetail.id))==null?void 0:s.batch)||this.emptyBatchResponse},runDetail(){return this.getRunDetail(this.apiDetail.id).time||"00:00:00 (0000000ms)"},responseData(){var s,e;return this.responseActive==="BatchResponse"?(s=this.batchResponse[this.batchResponseActive])==null?void 0:s.ResponseData:(e=this.response)==null?void 0:e.ResponseData},responseHeader(){var s,e;return this.responseActive==="BatchResponse"?(s=this.batchResponse[this.batchResponseActive])==null?void 0:s.ResponseHeader:(e=this.response)==null?void 0:e.ResponseHeader},tabActiveIsResData(){return this.responseActive==="BatchResponse"?this.nextResponseActive==="ResponseData":this.responseActive==="ResponseData"}},watch:{response(s,e){this.responseActive="ResponseData",this.foldFlag&&this.onFoldClick()},batchResponse(s,e){this.responseActive="BatchResponse",this.batchResponseActive=0,this.nextResponseActive="ResponseData",this.foldFlag&&this.onFoldClick()}},created(){},mounted(){this.$refs.responseDetail.querySelector(".response-tabs > .el-tabs__header").prepend(this.$refs.responseFold)},methods:{onTabClick(){this.foldFlag&&this.onFoldClick()},onDragEnd(){this.foldFlag&&(this.foldFlag=!this.foldFlag)},onFoldClick(){this.foldFlag=!this.foldFlag,this.$refs.responseDetail.style.flex=this.foldFlag?"0 0 auto":"15 0 0"},isDownloadLink(s,e){const{content:r,key:m}=s;return m!=="download"?!1:(s._content=JSON.parse(r),s._content.isDownload)},updateResponseDocument(){this.update("tb_request_api.update",this.apiDetail).then(s=>this.$message({type:"success",showClose:!0,message:"更新完成",center:!0}))},headerCellRenderer(s){const e=()=>{let r=S(s,void 0,void 0,!0);s.length===1&&s[0].type==="List"&&!s[0].key&&(r=r[Object.keys(r)[0]]),this.jsonView=r,this.showView=!0};return n(i("el-button"),{icon:"View",size:"small",circle:!0,onClick:e},null)}}},q={class:"response-detail",ref:"responseDetail"},O={class:"response-detail-wrapper"},P={class:"show-document"},W=["href","download"],G={class:"run-detail"};function K(s,e,r,m,t,a){const C=i("s3-drag-line"),c=i("el-tab-pane"),R=i("el-tabs"),_=i("el-button"),b=i("s3-json"),g=i("s3-scroll"),F=i("api-table"),A=i("el-drawer"),B=i("Java2Api"),j=i("ArrowUp"),x=i("ArrowDown"),J=i("el-icon");return p(),h(v,null,[u("div",q,[n(C,{"z-index":2,onDragEnd:a.onDragEnd},null,8,["onDragEnd"]),n(R,{modelValue:t.responseActive,"onUpdate:modelValue":e[2]||(e[2]=o=>t.responseActive=o),class:"response-tabs",onTabClick:a.onTabClick},{default:l(()=>[n(c,{label:"ResponseData",name:"ResponseData"}),n(c,{label:"ResponseHeader",name:"ResponseHeader"}),n(c,{label:"BatchResponse",name:"BatchResponse"},{default:l(()=>[D(n(R,{modelValue:t.batchResponseActive,"onUpdate:modelValue":e[1]||(e[1]=o=>t.batchResponseActive=o)},{default:l(()=>[(p(!0),h(v,null,T(a.batchResponse,(o,d)=>(p(),V(c,{label:`结果${d+1}`,name:d},{default:l(()=>[n(R,{modelValue:t.nextResponseActive,"onUpdate:modelValue":e[0]||(e[0]=U=>t.nextResponseActive=U),class:"batch-res"},{default:l(()=>[n(c,{label:"ResponseData",name:"ResponseData"}),n(c,{label:"ResponseHeader",name:"ResponseHeader"})]),_:1},8,["modelValue"])]),_:2},1032,["label","name"]))),256))]),_:1},8,["modelValue"]),[[f,!t.foldFlag]])]),_:1})]),_:1},8,["modelValue","onTabClick"]),u("div",O,[u("div",P,[n(_,{icon:"ArrowDown",class:"operation",text:"",size:"small",onClick:e[3]||(e[3]=o=>t.showDocument=!0)},{default:l(()=>[w("字段描述")]),_:1})]),D(n(g,{class:"res-data"},{default:l(()=>[n(b,{deep:t.jsonDeep,class:"res-data-wrapper",modelValue:a.responseData,showLineNumber:"",showLength:"",showLine:"",showIcon:""},{renderNodeValue:l(({node:o,defaultValue:d})=>[a.isDownloadLink(o,d)?(p(),h("a",{key:0,href:o._content.downloadUrl,download:o._content.fileName},"点我下载",8,W)):(p(),h(v,{key:1},[w(y(d),1)],64))]),_:1},8,["deep","modelValue"])]),_:1},512),[[f,a.tabActiveIsResData]]),D(n(g,{class:"res-header"},{default:l(()=>[n(b,{deep:t.jsonDeep,class:"res-header-wrapper",modelValue:a.responseHeader,showLineNumber:"",showLength:"",showLine:"",showIcon:""},null,8,["deep","modelValue"])]),_:1},512),[[f,!a.tabActiveIsResData]])]),u("div",G,y(a.runDetail),1)],512),n(A,{modelValue:t.showDocument,"onUpdate:modelValue":e[6]||(e[6]=o=>t.showDocument=o),title:"Response Body Document Config",size:"70%"},I({default:l(()=>[n(F,{modelValue:a.responseDocument,"onUpdate:modelValue":e[4]||(e[4]=o=>a.responseDocument=o),"header-cell-renderer":a.headerCellRenderer},null,8,["modelValue","header-cell-renderer"])]),_:2},[!m.isShare&&m.apiDetail.id?{name:"footer",fn:l(()=>[n(_,{icon:"Pointer",type:"primary",onClick:e[5]||(e[5]=o=>t.analysisJavaDocument=!0)},{default:l(()=>[w("Analysis Java Document With Swagger")]),_:1}),n(_,{icon:"Edit",type:"primary",onClick:a.updateResponseDocument},{default:l(()=>[w("更新API")]),_:1},8,["onClick"])]),key:"0"}:void 0]),1032,["modelValue"]),n(A,{modelValue:t.showView,"onUpdate:modelValue":e[8]||(e[8]=o=>t.showView=o),title:"Response Body Document View",size:"50%"},{default:l(()=>[n(b,{modelValue:t.jsonView,"onUpdate:modelValue":e[7]||(e[7]=o=>t.jsonView=o),showLineNumber:"",showLength:"",showLine:"",showIcon:""},null,8,["modelValue"])]),_:1},8,["modelValue"]),n(B,{modelValue:t.analysisJavaDocument,"onUpdate:modelValue":e[9]||(e[9]=o=>t.analysisJavaDocument=o),onAnalysisSuccess:e[10]||(e[10]=o=>a.responseDocument=o)},null,8,["modelValue"]),D(u("div",{class:"response-fold el-tabs__item",ref:"responseFold",onClick:e[11]||(e[11]=(...o)=>a.onFoldClick&&a.onFoldClick(...o))},[n(J,null,{default:l(()=>[t.foldFlag?(p(),V(j,{key:0})):(p(),V(x,{key:1}))]),_:1})],512),[[f,!1]])],64)}const se=E(z,[["render",K],["__scopeId","data-v-975c9ea6"]]);export{se as R};
