import{A as U}from"./detail/ApiTable.D7fy3Poe.js";import{t as z}from"../util/request.utils.CJX_gtFp.js";import{J as I}from"./detail/Java2Api.Bq15W0K3.js";import{r as A}from"../../../../stores/request.server.apbYzn03.js";import{e as o,a8 as H,r as l,a as m,l as p,j as R,w as r,v as w,t as y,k as N,F as b,o as d,d as T,h as E,c as V,f as h}from"../../../../.store.ssRjOe-B.js";import{_ as q}from"../../../../components/address/S3Address.Dp8cFelg.js";const O={name:"ResponseDetail",components:{Java2Api:I,ApiTable:U},setup(){const s=A(),{getRunDetail:e}=s,{isShare:i,apiDetail:u}=H(A());return{isShare:i,apiDetail:u,getRunDetail:e,useRequestStore:s}},emits:[],props:{},data(){return{responseActive:"ResponseData",showDocument:!1,showView:!1,jsonView:void 0,analysisJavaDocument:!1,foldFlag:!0,jsonDeep:2,nextResponseActive:"ResponseData"}},computed:{responseDocument:{get(){return this.apiDetail.config.responseDocument||(this.apiDetail.config.responseDocument=[]),this.apiDetail.config.responseDocument},set(s){this.apiDetail.config.responseDocument=s}},runDetail(){return this.getRunDetail(this.apiDetail.id)},response(){var s;return(s=this.runDetail)==null?void 0:s.once},batchResponse(){var s;return(s=this.runDetail)==null?void 0:s.batch},isBatchResponse(){return this.responseActive.startsWith("bp_")},resDetail(){var e,i;let s=((i=(e=this.response)==null?void 0:e.ContentSize)==null?void 0:i.call(e))||"0B";return"Time:"+(this.runDetail.time||"00:00:00 (0000000ms)")+" Size:"+s},batchIndex(){return this.isBatchResponse?Number(this.responseActive.slice(3)):0},responseData(){var s,e;return this.isBatchResponse?(s=this.batchResponse[this.batchIndex])==null?void 0:s.ResponseData:(e=this.response)==null?void 0:e.ResponseData},responseHeader(){var s,e;return this.isBatchResponse?(s=this.batchResponse[this.batchIndex])==null?void 0:s.ResponseHeader:(e=this.response)==null?void 0:e.ResponseHeader},tabActiveIsResData(){return this.isBatchResponse?this.nextResponseActive==="ResponseData":this.responseActive==="ResponseData"}},watch:{response(s,e){this.responseActive="ResponseData",this.foldFlag&&this.onFoldClick()},batchResponse(s,e){this.responseActive=s?"bp_0":"ResponseData",this.nextResponseActive="ResponseData",this.foldFlag&&this.onFoldClick()}},created(){},mounted(){this.$refs.responseDetail.querySelector(".response-tabs > .el-tabs__header").prepend(this.$refs.responseFold)},methods:{isDownload(s){if(s.key!=="download")return!1;const e=JSON.parse(s.content);return e.isDownload?(s._content=e,!0):!1},onTabClick(){this.foldFlag&&this.onFoldClick()},onDragEnd(){this.foldFlag&&(this.foldFlag=!this.foldFlag)},onFoldClick(){this.foldFlag=!this.foldFlag,this.$refs.responseDetail.style.height="auto",this.$refs.responseDetail.style.flex=this.foldFlag?"0 0 auto":"15 0 0"},updateResponseDocument(){this.update("tb_request_api.update",this.apiDetail).then(s=>this.$message({type:"success",showClose:!0,message:"更新完成",center:!0}))},headerCellRenderer(s){const e=()=>{let i=z(s,void 0,void 0,!0);s.length===1&&s[0].type==="List"&&!s[0].key&&(i=i[Object.keys(i)[0]]),this.jsonView=i,this.showView=!0};return o(l("el-button"),{icon:"View",size:"small",circle:!0,onClick:e},null)}}},L={class:"response-detail",ref:"responseDetail"},P={class:"response-detail-wrapper"},W={class:"show-document"},G={class:"res-data"},K=["href","download"],M={class:"res-header"},Q={class:"run-detail"};function X(s,e,i,u,a,n){const C=l("s3-drag-line"),c=l("el-tab-pane"),v=l("el-tabs"),D=l("el-button"),f=l("s3-json"),F=l("api-table"),g=l("el-drawer"),S=l("Java2Api"),x=l("ArrowUp"),j=l("ArrowDown"),B=l("el-icon");return d(),m(b,null,[p("div",L,[o(C,{"z-index":2,onDragEnd:n.onDragEnd},null,8,["onDragEnd"]),o(v,{modelValue:a.responseActive,"onUpdate:modelValue":e[1]||(e[1]=t=>a.responseActive=t),class:"response-tabs",onTabClick:n.onTabClick},{default:r(()=>[o(c,{label:"ResponseData",name:"ResponseData"}),o(c,{label:"ResponseHeader",name:"ResponseHeader"}),n.batchResponse&&n.batchResponse.length?(d(!0),m(b,{key:0},E(n.batchResponse,(t,_)=>{var k;return d(),V(c,{key:_,label:`结果${_+1}(${(k=t.ContentSize)==null?void 0:k.call(t,n.runDetail.time)})`,name:"bp_"+_},{default:r(()=>[o(v,{modelValue:a.nextResponseActive,"onUpdate:modelValue":e[0]||(e[0]=J=>a.nextResponseActive=J),class:"batch-res"},{default:r(()=>[o(c,{label:"ResponseData",name:"ResponseData"}),o(c,{label:"ResponseHeader",name:"ResponseHeader"})]),_:1},8,["modelValue"])]),_:2},1032,["label","name"])}),128)):T("",!0)]),_:1},8,["modelValue","onTabClick"]),p("div",P,[p("div",W,[o(D,{icon:"ArrowDown",class:"operation",text:"",size:"small",onClick:e[2]||(e[2]=t=>a.showDocument=!0)},{default:r(()=>[h("响应字段描述")]),_:1})]),R(p("div",G,[o(f,{class:"res-data-wrapper",modelValue:n.responseData,deep:a.jsonDeep},{value:r(t=>[n.isDownload(t)?(d(),m("a",{key:0,href:t._content.downloadUrl,download:t._content.fileName},"点我保存",8,K)):(d(),m(b,{key:1},[h(y(String(t.content)),1)],64))]),_:1},8,["modelValue","deep"])],512),[[w,n.tabActiveIsResData]]),R(p("div",M,[o(f,{class:"res-header-wrapper",modelValue:n.responseHeader,deep:a.jsonDeep},null,8,["modelValue","deep"])],512),[[w,!n.tabActiveIsResData]])]),p("div",Q,y(n.resDetail),1)],512),o(g,{modelValue:a.showDocument,"onUpdate:modelValue":e[5]||(e[5]=t=>a.showDocument=t),title:"Response Body Document Config",size:"70%"},N({default:r(()=>[o(F,{modelValue:n.responseDocument,"onUpdate:modelValue":e[3]||(e[3]=t=>n.responseDocument=t),"header-cell-renderer":n.headerCellRenderer},null,8,["modelValue","header-cell-renderer"])]),_:2},[!u.isShare&&u.apiDetail.id?{name:"footer",fn:r(()=>[o(D,{icon:"Pointer",type:"primary",onClick:e[4]||(e[4]=t=>a.analysisJavaDocument=!0)},{default:r(()=>[h("Analysis Java Document With Swagger")]),_:1}),o(D,{icon:"Edit",type:"primary",onClick:n.updateResponseDocument},{default:r(()=>[h("更新API")]),_:1},8,["onClick"])]),key:"0"}:void 0]),1032,["modelValue"]),o(g,{modelValue:a.showView,"onUpdate:modelValue":e[7]||(e[7]=t=>a.showView=t),title:"Response Body Document View",size:"50%"},{default:r(()=>[o(f,{modelValue:a.jsonView,"onUpdate:modelValue":e[6]||(e[6]=t=>a.jsonView=t),showLineNumber:"",showLength:"",showLine:"",showIcon:""},null,8,["modelValue"])]),_:1},8,["modelValue"]),o(S,{modelValue:a.analysisJavaDocument,"onUpdate:modelValue":e[8]||(e[8]=t=>a.analysisJavaDocument=t),onAnalysisSuccess:e[9]||(e[9]=t=>n.responseDocument=t)},null,8,["modelValue"]),R(p("div",{class:"response-fold el-tabs__item",ref:"responseFold",onClick:e[10]||(e[10]=(...t)=>n.onFoldClick&&n.onFoldClick(...t))},[o(B,null,{default:r(()=>[a.foldFlag?(d(),V(x,{key:0})):(d(),V(j,{key:1}))]),_:1})],512),[[w,!1]])],64)}const ne=q(O,[["render",X],["__scopeId","data-v-08e79f5d"]]);export{ne as R};
