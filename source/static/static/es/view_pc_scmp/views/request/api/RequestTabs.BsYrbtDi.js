import{R as S}from"./ResponseDetail.cqpkDBqS.js";import{R as O}from"./RequestDetail.BykTnGZq.js";import{r as w}from"../../../../stores/request.server.OPoUfqQ8.js";import{b as k,u as x,a as L}from"../../../../resources/global/global.util.CrvsVFo3.js";import{h as D,c as P,d as B,e as K,l as V,s as F,u as U}from"../util/request.utils.Cc8QJvHY.js";import{_ as $}from"../../../../components/address/S3Address.BvGSUWFm.js";import{s as N}from"../../../../pinia.DPawhP_y.js";import{a as T,e as o,l as M,w as r,F as E,r as p,q as j,o as v,h as z,c as q,j as J,B as G,f as u,t as I}from"../../../../vue.CpRb0aFL.js";import"./detail/ApiTable.gZ2cokSO.js";import"../../../../resources/util/snowflake.util.C4QYlgiq.js";import"../../../../sortablejs.C83syoBY.js";import"../../../../resources/util/map.BoklfroI.js";import"./detail/Java2Api.CojP8dLI.js";import"../../../../antlr4.BZgrZd6q.js";import"../../../../resources/antlr4/java8/Java8Lexer.DkrHY6x9.js";import"../../../../resources/antlr4/java8/Java8Parser.CF2-JRMB.js";import"../../../../resources/antlr4/java8/Java8ParserListener.qTYW0woq.js";import"../../../../resources/antlr4/java8/Java8ParserVisitor.CeAJKNNA.js";import"../../../../resources/antlr4/java8/impl/java8.listener.C6gDuRmP.js";import"./detail/Query.B-fpzoBb.js";import"./detail/Header.CAE6ZL7S.js";import"./detail/Body.CPj_-PzE.js";import"./detail/ViewApi.COP0tsSj.js";import"./detail/Detail.Bp1n2s64.js";import"../../../../resources/util/cache.indexeddb.CXuVJu8M.js";import"../../../../resources/util/timer.util.DJ34cZ81.js";import"../../../../js.DlQi3gKf.js";import"../../../../md5.DCeuUgf6.js";import"../../../../charenc.DHEmDxqN.js";import"../../../../resources/util/crypto.util.Cg1BRL9K.js";import"../../../../crypto.tqJ8oQci.js";import"../../../../../../public.scmp.config.js";const H={name:"RequestTabs",components:{RequestDetail:O,ResponseDetail:S},setup(){const{defaultApiDetail:e,clearApiCache:t,getFileDetail:i,setResDetailOnce:s,setRunDetail:l,getRunDetail:a,setOtherConfigCache:d}=w(),{isShare:_,apiDetail:f,apiDetailClone:y,selectEntityId:g,entityMap:m,apiChangeDetail:c}=N(w());return{defaultApiDetail:e,isShare:_,apiDetail:f,apiDetailClone:y,selectEntityId:g,entityMap:m,apiChangeDetail:c,clearApiCache:t,getFileDetail:i,setResDetailOnce:s,setRunDetail:l,getRunDetail:a,setOtherConfigCache:d}},emits:[],props:{},data(){return{tooltipData:{},showTooltip:!1,tooltipRef:void 0,showTooltipDebounce:L((e,t)=>{if(!e)return this.showTooltip=!1;this.tooltipData=t,this.tooltipRef=e,this.showTooltip=!!t.name},.3)}},computed:{},watch:{selectEntityId:{immediate:!0,handler(e,t){if(!this.entityMap.contains(e))return;let i;this.apiChangeDetail.contains(e)&&(i=this.apiChangeDetail.get(e).nApi),this.apiDetail=i||this.entityMap.get(e),this.isShare||this.setOtherConfigCache("RequestApi_Select_Flag",e),this.apiDetailClone=this.apiChangeDetail.getOrDefault(e,()=>({oApi:k(this.entityMap.get(e))})).oApi}}},created(){this.isShare||document.addEventListener("keydown",this.onKeyDownSave)},mounted(){},beforeUnmount(){this.isShare||document.removeEventListener("keydown",this.onKeyDownSave)},methods:{buildReq(e){const{domain:t,contextPath:i,prefix:s,url:l,sse:a}=e.config,d=x(t,i,s,l),_=new URL(d).hostname,f=U(_),y={decryEncryAttempt:this.$decryEncryAttempt,responseType:"arraybuffer",ignore401:!0},g=this.getFileDetail(e.id),m=f?B(e,g):K(d,1,this.$decryEncryAttempt,e,g),{method:c,headers:A,params:R,data:b}=m,n=h=>this.setResDetailOnce(e.id,D(h));return f?V(c,d,A,R,b):a?F(this.$baseUrl,"POST","request/api/reqSSE",m,y,n):this.$http.post("request/api/req",m,y)},batchRunOpenApi(e){e==="waitLast"?this.entityMap.values().reduce((t,i)=>t.then(()=>(this.setRunDetail(i.id,!0),this.buildReq(i).then(s=>this.setResDetailOnce(i.id,D(s))).catch(s=>this.setResDetailOnce(i.id,P(s))).finally(()=>{this.setRunDetail(i.id,!1),this.$message({message:`API[ ${i.name} ]已执行,请查看对应的标签页`,type:"success"})}))),Promise.resolve()).then(()=>({})):e==="and"&&this.entityMap.values().forEach(t=>{this.setRunDetail(t.id,!0),this.buildReq(t).then(i=>{this.setResDetailOnce(t.id,D(i))}).finally(()=>{this.setRunDetail(t.id,!1),this.$message({message:`API[ ${t.name} ]已执行,请查看对应的标签页`,type:"success"})})})},onKeyDownSave(e){if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==="s"){if(e.preventDefault(),!this.apiChangeDetail.contains(this.apiDetail.id))return;this.updateApi(this.apiDetail).then(t=>{this.apiDetailClone=k(this.apiDetail),this.apiChangeDetail.remove(this.apiDetail.id),this.$message({type:"success",showClose:!0,message:"更新完成",center:!0})})}},apiTabOnMouseover(e,t){this.showTooltipDebounce(e.currentTarget,t)},closeApi(e,t){let i=this.entityMap.keys();t==="other"?this.entityMap.deleteOther(e):t==="left"?this.entityMap.deleteLeft(e):t==="right"&&this.entityMap.deleteRight(e);const s=this.entityMap.keys();i.filter(l=>!s.includes(l)).forEach(l=>this.clearApiCache()),this.entityMap.contains(this.selectEntityId)||(this.selectEntityId=s[0])},closeAllApi(e){this.entityMap.deleteAll(),this.entityMap.put(-1,this.defaultApiDetail),this.selectEntityId=-1,this.clearApiCache()},closeThisApi(e){const{id:t}=this.entityMap.delete(e);this.selectEntityId===t&&(this.selectEntityId=this.entityMap.getKey(e===0?0:e-1)),this.entityMap.isEmpty()&&(this.entityMap.put(-1,this.defaultApiDetail),this.selectEntityId=-1),this.clearApiCache(t)},showRightMenu(e,t,i){e.preventDefault(),!(this.isShare||t.id===-1)&&this.$refs.rightMenu.click(e,i)},entityRemove(e){const t=this.entityMap.indexOf(e),i=this.entityMap.get(e);if(this.isShare||!this.apiChangeDetail.contains(e))return this.closeThisApi(t);const s={confirmButtonText:"更新",cancelButtonText:"取消",type:"warning"};this.$confirm(`API: ${i.name}`,"API更新未保存",s).then(l=>this.updateApi(this.apiChangeDetail.get(i.id).nApi)).then(l=>this.$message({type:"success",showClose:!0,message:"更新完成",center:!0})).catch(()=>{}).finally(()=>this.closeThisApi(t))},updateApi(e){const t=[e.name,e.config.url].filter(Boolean).join(" ");return this.update("tb_request_api.update",{...e,search:t})}}},Q=["onContextmenu","onMouseenter"],W={class:"tabs-content"};function X(e,t,i,s,l,a){const d=p("el-text"),_=p("el-tab-pane"),f=p("el-tabs"),y=p("el-tooltip"),g=p("request-detail"),m=p("response-detail"),c=p("el-link"),A=p("s3-icon"),R=p("s3-right-menu"),b=j("loading");return v(),T(E,null,[o(f,{type:"card",class:"request-tabs",modelValue:s.selectEntityId,"onUpdate:modelValue":t[1]||(t[1]=n=>s.selectEntityId=n),closable:!s.isShare,onTabRemove:a.entityRemove},{default:r(()=>[(v(!0),T(E,null,z(s.entityMap.values(),(n,h)=>(v(),q(_,{label:n.name,name:n.id},{label:r(()=>[M("div",{class:"label-wrapper",onContextmenu:C=>a.showRightMenu(C,n,h),onMouseenter:C=>a.apiTabOnMouseover(C,n),onMouseleave:t[0]||(t[0]=C=>l.showTooltipDebounce())},[M("div",{style:G({opacity:s.apiChangeDetail.contains(n.id)?1:0,height:"100%"})},"*",4),J((v(),q(d,{class:"doc-method","data-text":n.config.method},{default:r(()=>[u(I(n.config.method),1)]),_:2},1032,["data-text"])),[[b,s.getRunDetail(n.id).loading]]),o(d,{class:"title",truncated:""},{default:r(()=>[u(I(n.name),1)]),_:2},1024)],40,Q)]),_:2},1032,["label","name"]))),256))]),_:1},8,["modelValue","closable","onTabRemove"]),o(y,{visible:l.showTooltip,"virtual-ref":l.tooltipRef,content:l.tooltipData.name,placement:"bottom",effect:"customized"},null,8,["visible","virtual-ref","content"]),M("div",W,[o(g),o(m)]),o(R,{ref:"rightMenu"},{default:r(({scope:n})=>[o(c,{icon:"Close",underline:!1,onClick:h=>a.closeThisApi(n)},{default:r(()=>[u("关闭文档")]),_:2},1032,["onClick"]),o(c,{icon:"Close",underline:!1,onClick:h=>a.closeApi(n,"other")},{default:r(()=>[u("关闭其他文档")]),_:2},1032,["onClick"]),o(c,{icon:"Close",underline:!1,onClick:h=>a.closeAllApi(n,"all")},{default:r(()=>[u("关闭全部文档")]),_:2},1032,["onClick"]),o(c,{icon:"Close",underline:!1,onClick:h=>a.closeApi(n,"left")},{default:r(()=>[u("关闭左侧文档")]),_:2},1032,["onClick"]),o(c,{icon:"Close",underline:!1,onClick:h=>a.closeApi(n,"right")},{default:r(()=>[u("关闭右侧文档")]),_:2},1032,["onClick"]),o(c,{icon:"Right",class:"border-line",underline:!1,onClick:t[2]||(t[2]=h=>a.batchRunOpenApi("waitLast"))},{default:r(()=>[u("顺序执行打开的API")]),_:1}),o(c,{underline:!1,onClick:t[3]||(t[3]=h=>a.batchRunOpenApi("and"))},{default:r(()=>[o(A,{icon:"s_turn_left"}),u("并行执行打开的API")]),_:1})]),_:1},512)],64)}const qe=$(H,[["render",X],["__scopeId","data-v-e589b4d9"]]);export{qe as default};
