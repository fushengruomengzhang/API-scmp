import{r as c}from"../../../../../stores/request.server.OPoUfqQ8.js";import{_ as C}from"../../../../../components/address/S3Address.BvGSUWFm.js";import{s as _}from"../../../../../pinia.DPawhP_y.js";import{ah as E,c as V,w as a,r as l,o as b,e as s,f as v}from"../../../../../vue.CpRb0aFL.js";const O={name:"EnvironmentIndex",components:{},setup(){const{getOtherConfigCache:e,setOtherConfigCache:n}=c(),{domainOptions:t}=_(c());return{domainOptions:t,getOtherConfigCache:e,setOtherConfigCache:n}},emits:["update:modelValue"],props:{modelValue:{type:Boolean,default:!1},localEnv:{type:Boolean,default:!1}},data(){return{envConfig:{id:void 0,key:"requestEnvConfig",value:[{name:void 0,domain:void 0}]}}},computed:{},watch:{},created(){this.localEnv?this.findLocalEnv():this.findAllEnv()},mounted(){},methods:{findLocalEnv(){this.getOtherConfigCache("Local_Env_Config").then(e=>{e&&(this.envConfig.value=e.value)})},findAllEnv(){this.findOne("tb_config.findAll",{key:"requestEnvConfig"}).then(e=>{e.data.id&&(this.envConfig=e.data)})},submit(){this.$refs.envForm.validate(e=>{e&&new Promise(n=>{this.localEnv?n(this.setOtherConfigCache("Local_Env_Config",E(this.envConfig.value))):this.envConfig.id?n(this.update("tb_config.update",this.envConfig)):n([this.save("tb_config.save",this.envConfig)])}).then(n=>{this.domainOptions.removeIf(t=>t.localEnv===this.localEnv),this.envConfig.value.reverse().forEach(({name:t,domain:m})=>{this.domainOptions.insert(this.localEnv?0:this.domainOptions.length,{name:t,domain:m,localEnv:this.localEnv})}),this.$emit("update:modelValue",!1),this.$message({type:"success",showClose:!0,message:"提交成功",center:!0})})})}}};function $(e,n,t,m,r,p){const d=l("s3-form-input"),h=l("s3-form-trends"),u=l("el-button"),g=l("s3-form");return b(),V(g,{class:"env-form",model:r.envConfig,ref:"envForm","hide-field":["key"]},{footer:a(()=>[s(u,{onClick:p.submit},{default:a(()=>[v("提交")]),_:1},8,["onClick"]),s(u,{onClick:n[1]||(n[1]=o=>e.$refs.envForm.resetFields())},{default:a(()=>[v("重置")]),_:1})]),default:a(()=>[s(h,{modelValue:r.envConfig.value,"onUpdate:modelValue":n[0]||(n[0]=o=>r.envConfig.value=o)},{default:a(({index:o,model:i})=>[s(d,{span:12,label:`name[${o}]`,prop:`value.${o}.name`,rules:{required:!0,message:"Place Config Environment Name"},modelValue:i.name,"onUpdate:modelValue":f=>i.name=f},null,8,["label","prop","modelValue","onUpdate:modelValue"]),s(d,{span:12,label:`domain[${o}]`,prop:`value.${o}.domain`,rules:{required:!0,message:"Place Config Environment Domain"},modelValue:i.domain,"onUpdate:modelValue":f=>i.domain=f},null,8,["label","prop","modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue"])]),_:1},8,["model"])}const U=C(O,[["render",$]]);export{U as E};
