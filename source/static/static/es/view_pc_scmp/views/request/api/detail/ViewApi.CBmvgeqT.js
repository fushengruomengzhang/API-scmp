import{u as k,e as E}from"../../../../../resources/global/global.util.CdGU-cda.js";import{i as _}from"../../util/request.utils.C-Y0rqBy.js";import{s as T}from"../../../../../resources/util/snowflake.util.CMOmz3k-.js";import{r as I}from"../../../../../stores/request.server.Jl9Oinz8.js";import{_ as G}from"../../../../../components/address/S3Address.C-l0MtE3.js";import{s as L}from"../../../../../pinia.C4zkjZtA.js";import{c as w,w as v,r as C,x as W,o as j,e as F,j as P,f as V}from"../../../../../vue.B9VI7CMM.js";const H={name:"ViewApi",components:{},setup(){const{isShare:t,apiDetail:o}=L(I());return{isShare:t,apiDetail:o}},emits:["update:modelValue"],props:{modelValue:{type:Boolean,default:!1}},data(){return{docWrapContent:void 0,typeDefaultValue:{String:"",Integer:0,List:[],Object:{}},copyOptions:{content:void 0,msg:"文档复制成功",groupId:T("copy"),onSuccess:t=>this.$message({type:"success",showClose:!0,message:this.copyOptions.msg,center:!0}),options:{text:t=>this.copyOptions.content}}}},computed:{show:{get(){return this.modelValue&&this.viewDocument(this.apiDetail),this.modelValue},set(t,o){this.$emit("update:modelValue",t)}}},watch:{},created(){},mounted(){},beforeUnmount(){},methods:{shareDocument(){const{origin:t,pathname:o}=window.location,m=E(this.apiDetail.id.toString());this.copyOptions.content=k(t,o)+`#/shareRequest?id=${m}`,this.copyOptions.msg="分享链接已复制"},buildCopyContent(){const{name:t,desc:o,config:{method:m,contextPath:c,prefix:h,url:l,header:f,query:s,bodyDocument:i,responseDocument:r}}=this.apiDetail;let u=[],p=[],y=[],g=[];f&&f.length&&(u=f.map(d=>`${d.key}:${d.value.substring(0,30)}... // ${d.desc} ${d.check?"必填":""}`)),s&&s.length&&(p=_(s)),i&&i.length&&(y=_(i)),r&&r.length&&(g=_(r,"",void 0,!0));const a={};a[t]=o,a[m]=k(c,h,l),a.Header=u,a["Query Param"]=p,a["Body Param"]=y,a["Response Document"]=g;const S=JSON.stringify(a,null,4);this.copyOptions.content=S.substring(1,S.length-1).replaceAll(`
    `,`
`),this.copyOptions.msg="文档复制成功"},viewDocument(t){const{name:o,desc:m,config:{method:c,contextPath:h,prefix:l,url:f,header:s,query:i,queryBody:r,bodyDocument:u,responseDocument:p}}=t;let y,g=k(h,l,f),a=`|参数名|参数值|描述|必填|
|----|-|-|----|`,S=`|参数名|参数值|描述|必填|
|----|-|-|----|`,d={},$={},q=[],D=[],O,x=!1;if(s&&s.length&&s.forEach(e=>{const n=e.value.toString().length>30?e.value.toString().substring(0,30)+"...":e.value;a+=`
|${e.key}|${n}|${e.desc}|${e.check}`}),i&&i.length){i.forEach(n=>{const b=n.value.toString().length>30?n.value.toString().substring(0,30)+"...":n.value;S+=`
|${n.key}|${b}|${n.desc}|${n.check}`,d[n.key]=n.value});const e=c==="GET"?"params":"queryParams";y=g.replace(/\{([^}]+)}/g,(n,b)=>b?(x=!0,`\${${e}["${b}"]}`):n)}if(u&&u.length&&(q=_(u,"",$)),p&&p.length&&(D=_(p,"",void 0,!0),p.length===1&&p[0].type==="List"&&(O=Object.keys(D)[0],D=D[O])),r&&r.length){let e=new Function("return "+r)();e instanceof Array?e.length&&($=e):e instanceof Object&&Object.keys(e).length&&($=e)}const B=!x||c==="GET"?void 0:`const queryParams = ${JSON.stringify(d,null,4)}`,A=`const params = ${JSON.stringify(c==="GET"?d:$,null,4)};`,J=`const path = \`${y||g}\`;`,N=`this.$http.${c.toLowerCase()}(path, ${c==="GET"?"{params}":"params"}).then(res=>{})`,R=[["# Axios","```js",[`// ${o}`,B,A,J,N].filter(e=>e).join(`
`),"```"].join(`
`),["# Response Document","```json",O,JSON.stringify(D,null,4),"```"].filter(Boolean).join(`
`),["# Request Header",a].join(`
`),["# Query Param",S].join(`
`),["# Body Param","```json",JSON.stringify(q,null,4),"```"].join(`
`)];this.docWrapContent=R.join(`
`)}}};function Q(t,o,m,c,h,l){const f=C("s3-doc"),s=C("el-button"),i=C("s3-dialog"),r=W("copy");return j(),w(i,{modelValue:l.show,"onUpdate:modelValue":o[0]||(o[0]=u=>l.show=u),title:"API预览"},{footer:v(()=>[P((j(),w(s,{icon:"CopyDocument",onClick:l.buildCopyContent},{default:v(()=>[V("复制文档")]),_:1},8,["onClick"])),[[r,h.copyOptions]]),P((j(),w(s,{icon:"Share",onClick:l.shareDocument},{default:v(()=>[V("分享API")]),_:1},8,["onClick"])),[[r,h.copyOptions]])]),default:v(()=>[F(f,{class:"document",content:h.docWrapContent},null,8,["content"])]),_:1},8,["modelValue"])}const te=G(H,[["render",Q]]);export{te as V};
