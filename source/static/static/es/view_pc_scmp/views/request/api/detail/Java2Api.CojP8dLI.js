import{a as v}from"../../../../../antlr4.BZgrZd6q.js";import{J as D}from"../../../../../resources/antlr4/java8/Java8Lexer.DkrHY6x9.js";import{J as S}from"../../../../../resources/antlr4/java8/Java8Parser.CF2-JRMB.js";import{s as _}from"../../../../../resources/util/snowflake.util.C4QYlgiq.js";import{J as C}from"../../../../../resources/antlr4/java8/impl/java8.listener.C6gDuRmP.js";import{M as y}from"../../../../../resources/util/map.BoklfroI.js";import{s as w}from"../../../../../resources/global/global.util.CrvsVFo3.js";import{_ as k}from"../../../../../components/address/S3Address.BvGSUWFm.js";import{c as T,w as h,r as f,o as V,l as g,e as m,f as j,aE as b,aF as A}from"../../../../../vue.CpRb0aFL.js";const J={name:"Java2Api",components:{},setup(){return{}},emits:["update:modelValue","analysisSuccess"],props:{modelValue:{type:Boolean,default:!1},javaContent:{type:Object,default:void 0}},data(){return{javaTypeMapping:{int:"Number",double:"Number",boolean:"Boolean",MultipartFile:"File"},javaSource:new y,classDetail:new y,fieldDetail:new y,loading:!1}},computed:{modelValue_:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},javaSource_(){if(!this.javaSource.isEmpty())return"```java\n"+this.javaSource.values().join(`

//================分割线==================

`)+"\n```"}},watch:{},created(){this.javaContent&&this.javaSource.putAll(this.javaContent)},mounted(){},methods:{onClosed(){this.javaSource.clear()},fileRemove(t,s){this.javaSource.remove(t.name)},fileChange(t,s){if(!t.raw)return;const n=new FileReader;new Promise(l=>n.onload=a=>l(a.target.result)).then(l=>this.javaSource.put(t.name,l)),n.readAsText(t.raw)},analysisJavaSource(){this.loading=!0,w(.1).then(()=>{try{this.javaSource.forEach((l,a)=>this.analysis(a));const t=this.fieldDetail.keys()[0],s=this.fieldDetail.get(t),n=this.deepClassType(s,0,[t]);this.$emit("analysisSuccess",n),this.modelValue_=!1,this.javaSource.clear(),this.classDetail.clear(),this.fieldDetail.clear()}catch(t){this.$message({message:"解析失败:"+t,type:"error"})}finally{this.loading=!1}})},analysis(t){if(!t)return;const s=new v.InputStream(t),n=new D(s),l=new v.CommonTokenStream(n),e=new S(l).compilationUnit(),o=new C;v.tree.ParseTreeWalker.DEFAULT.walk(o,e);const{fieldDetail:r,classDetail:c}=o;this.fieldDetail.putAll(r),this.classDetail.putAll(c)},deepTypeChild(t,s,n,l=[]){let a,e,o,r,c,u;if(s.length===1?a=s[0]:s.length===2&&([a,o]=s,o.length===1?(c="List",e=o[0]):o.length===2&&(c="Object",e=o[1])),l.includes(a)||l.includes(e))return{fieldType:"Object"};if(this.fieldDetail.contains(a)&&l.push(a),this.fieldDetail.contains(e)&&l.push(e),e instanceof Array){const d=_(),i=this.deepTypeChild(t,e,d,l);e=i.fieldType,r=[{parentId:n,id:d,type:i.arrayType,desc:a,check:!0,children:i.children,index:0}]}if(this.fieldDetail.contains(e)){const d=_(),i=this.deepClassType(this.fieldDetail.get(e),d,l);r=[{parentId:n,id:d,type:"Object",desc:e,check:!0,children:i,index:0}],l.pop()}return this.fieldDetail.contains(a)&&(r=this.deepClassType(this.fieldDetail.get(a),_(),l),u={fieldType:"Object",children:r,arrayType:c},l.pop()),u||(a=this.javaTypeMapping[a]||c||a,{fieldType:a,children:r,arrayType:c})},deepClassType(t=[],s,n=[]){return t.map(({type:l,name:a,annotation:e})=>{const o=_(),{fieldType:r,children:c}=this.deepTypeChild(a,l,o,n);let u=!0,d;if(e&&e.ApiModelProperty){const i=e.ApiModelProperty;if(typeof i=="string")d=i;else if(typeof i=="object"){const p=i.required;u=p===void 0||p==="true",d=i.value}}return{parentId:s,id:o,key:a,type:r,desc:d,check:u,children:c}})}}},x=t=>(b("data-v-3c1ee53f"),t=t(),A(),t),M={class:"java-document"},I=x(()=>g("div",{class:"el-upload__text"},[j("Drop java file here or "),g("em",null,"click to upload")],-1));function F(t,s,n,l,a,e){const o=f("upload-filled"),r=f("el-icon"),c=f("el-upload"),u=f("s3-doc"),d=f("el-button"),i=f("s3-dialog");return V(),T(i,{modelValue:e.modelValue_,"onUpdate:modelValue":s[1]||(s[1]=p=>e.modelValue_=p),title:"Analysis Java Document With Swagger",onClosed:e.onClosed},{footer:h(()=>[m(d,{onClick:e.analysisJavaSource,loading:a.loading},{default:h(()=>[j("解析")]),_:1},8,["onClick","loading"])]),default:h(()=>[g("div",M,[m(c,{class:"upload-file","on-change":e.fileChange,"on-remove":e.fileRemove,"auto-upload":!1,multiple:"",drag:"",accept:".java"},{default:h(()=>[m(r,{class:"el-icon--upload"},{default:h(()=>[m(o)]),_:1}),I]),_:1},8,["on-change","on-remove"]),m(u,{class:"java-source",content:e.javaSource_,"onUpdate:content":s[0]||(s[0]=p=>e.javaSource_=p)},null,8,["content"])])]),_:1},8,["modelValue","onClosed"])}const W=k(J,[["render",F],["__scopeId","data-v-3c1ee53f"]]);export{W as J};
