import{r as B,u as O,f as H}from"../../../../resources/global/global.util.BDToHPEB.js";import{a as C}from"../../../../resources/util/crypto.util.C7ecaPji.js";import{s as J}from"../../../../../../public.scmp.config.js";import{ae as P}from"../../../../.store.ssRjOe-B.js";const q=new TextDecoder("utf-8"),v={String:"",Number:0,Boolean:!1,List:[],Object:{}},R=t=>Array.isArray(t)?t.map(R):t!==null&&typeof t=="object"?Object.keys(t).sort().reduce((e,n)=>(e[n]=R(t[n]),e),{}):t,$=t=>{if(t)try{const e=R(t instanceof Object?t:new Function("return "+t)());return JSON.stringify(e,null,4).replace(new RegExp('(?<!\\\\)"([^"]+)":',"g"),'"$1": ')}catch(e){return e}},T=(t,e=void 0)=>{const n=e==="List"?[]:{};for(let f in t){let{key:c,type:a,value:o,children:r}=t[f];const i=e==="List";if(a==="List"||a==="Object"){const p=T(r,a);i?n.push(p):n[c]=p}else{let p=v[a];o&&(p=a==="Number"?Number(o):a==="Boolean"?new Function(`return !!${o}`)():o),i?n.push(p):n[c]=p}}return n},U=(t,e="",n=void 0,f=!1)=>{const c=e==="List"?[]:{};for(let a in t){let{check:o,key:r,type:i,value:p,desc:l,children:h}=t[a];const g=e==="List";if(i==="List"||i==="Object"){n&&(n[r]=i==="List"?[]:{});const u=e==="List"||!l?r:r+" // "+l;c[u]=U(h,i,n?n[r]:void 0,f)}else{const u=p||v[i];n&&(n[r]=u);const w=f?{类型:i,描述:l}:{参数值:u,参数类型:i,是否必填:o,描述:l};g?c.push(w):c[r]=w}}return c},M=t=>t.map((e,n)=>{const{name:f,desc:c,config:{method:a,contextPath:o,prefix:r,url:i}}=e;return`${n}. ${f}
    ${c||""}
    ${a} ${O(o,r,i)}`}).join(`

`),I=(t,e,n)=>{const{method:f,header:c,query:a,queryBody:o,bodyType:r,formBodyDocument:i}=e.config,p=r||"application/json",l={},h=c||[];(localStorage.get("RequestApi_GlobalRequestHeader")||[]).filter(s=>s.check).forEach(s=>l[s.key]=l[s.key]?l[s.key]+";"+s.value:s.value),h.filter(s=>s.check).forEach(s=>l[s.key]=l[s.key]?l[s.key]+";"+s.value:s.value);const u=!!h.filter(s=>s.key==="Content-Type").length;let w={},m;if(o&&(m=new Function("return "+o)()),E()){const s=S(e);a&&L(s,t,a),o&&L(s,t,m,"","Object"),i&&L(s,t,i)}return a&&a.filter(s=>s.check).forEach(s=>{w[s.key]||(w[s.key]=[]),w[s.key].push(s.value)}),["application/json","application/xml"].includes(p)?(u||(l["Content-Type"]=p),m=JSON.stringify(m)):p==="application/x-www-form-urlencoded"?u||(l["Content-Type"]=p):(m=new FormData,i.filter(s=>s.check).forEach(s=>{if(s.type==="File")s.value.filter(y=>n.contains(y)).forEach(y=>m.append(s.key,n.get(y).raw,y));else{let y=s.type!=="List"?s.value:s.children.map(b=>b.value);m.append(s.key,y)}})),{method:f,headers:l,params:w,data:m}},z=(t,e=1,n,f,c)=>{let{method:a,header:o,query:r,queryBody:i,bodyType:p,formBodyDocument:l,urlBodyDocument:h}=f.config;const g=p||"application/json",u=o?o.map(d=>d):[],w=localStorage.get("RequestApi_GlobalRequestHeader")||[],m=u.map(d=>d.key);w.filter(d=>d.check&&!m.includes(d.key)).forEach(d=>u.push(d));let s,y;if(["application/json","application/xml"].includes(g)?s=new Function("return "+i)():g==="application/x-www-form-urlencoded"?y=h:y=l,!!!u.filter(d=>d.key==="Content-Type").length&&(i||y&&y.length)&&u.push({check:!0,key:"Content-Type",value:g}),E()){const d=S(f);s&&L(d,e,s,"","Object"),y&&L(d,e,y),r&&L(d,e,r)}const _=c.values().map(d=>d.raw),A={reqNum:e,method:a,url:t,param:s,config:{header:u,query:r,body:y}},k=new FormData;_.forEach(d=>k.append("files",d,d.name));const N=n?C(JSON.stringify(A),"request/api/req"):JSON.stringify(A);return k.append("reqDetail",new Blob([N],{type:"application/json"}),"reqDetail.json"),k},S=({name:t,config:{method:e,contextPath:n,prefix:f,url:c}})=>({name:t,method:e,url:O(n,f,c)}),L=(t,e,n,f="",c)=>{c==="Object"?Object.keys(n).forEach(a=>{n[a]=D(t,e,a,n[a])}):n.forEach(a=>{const{key:o,value:r,type:i}=a;i!=="File"&&((i==="Object"||i==="List")&&L(t,e,r,[f,o].join(".")),a.value=D(t,e,o,r,f))})},D=(t,e,n,f,c)=>{if(!window._NBA_formatParam)return f;const a=window._NBA_formatParam(t,e,n,f,c);return a||f},E=()=>!!window._NBA_formatParam,K=t=>!!window._GM_xmlHttpRequest&&J.request.checkLocalIp&&["127.0.0.1","localhost"].includes(t),V=(t="GET",e,n,f,c)=>{if(!window._GM_xmlHttpRequest)return Promise.reject("请安装篡改猴>5.3.3插件,配置跨域脚本,详情请查看说明文档");if(!t||!e)return Promise.reject("请配置请求方法和请求路径,详情请查看说明文档");if(t=t.toLocaleUpperCase(),f)try{e=e.replace(/\{([^}]+)}/g,(a,o)=>f[o]||a),e=new URL(e),Object.entries(f).forEach(([a,o])=>o.forEach(r=>e.searchParams.append(a,r))),e=e.toString()}catch(a){return Promise.reject(a)}return["GET","HEAD"].includes(t)&&(c=void 0),new Promise((a,o)=>{window._GM_xmlHttpRequest({method:t,url:e,headers:n,data:c,onabort:r=>o("Local Request aborted"),onerror:r=>o(r.error||"Local Request Fail"),onload:r=>{const i={};r.responseHeaders.split(`\r
`).forEach(l=>{const[h,g]=l.split(":");i[h]=decodeURIComponent(g)});let p=r.response;r.status===200?a({_data:p,request:r,headers:i}):o({response:{data:p,headers:i,status:r.status}})}})})},X=(t,e,n,f,c,a)=>new Promise((o,r)=>{const{decryEncryAttempt:i}=c,p=O(t,n),l=new XMLHttpRequest;let h=P(""),g={};l.onreadystatechange=u=>{if(l.readyState===2)return l.getAllResponseHeaders().split(`\r
`).forEach(w=>{const[m,s]=w.split(":");m&&s&&(g[m]=decodeURIComponent(s))}),a({_data:h,headers:g});l.readyState===4&&o()},l.onprogress=u=>Object.assign(h,{value:l.response,byteLength:u.loaded}),l.open(e,p,!0),i||l.setRequestHeader("Attempt-Decry-Encry","Base64"),l.send(f)}),Q=t=>{let e=t._data,n=t.headers;if(n){n.toJSON&&(n=n.toJSON());const c=n["content-disposition"];if(c){const a=c.match(/filename\*=([^']*)'([^']*)'([^;]+)/);let o="";if(a){const[,p,,l]=a;o=decodeURIComponent(l)}if(!o){const p=c.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);p!=null&&p[1]&&(o=p[1].replace(/['"]/g,""))}const r=n["content-type"],i=URL.createObjectURL(new Blob([t.request.response],{type:r}));e={fileName:o,download:JSON.stringify({downloadUrl:i,fileName:o,isDownload:!0})}}}const f=B(()=>{var a,o;let c=((a=t._data)==null?void 0:a.byteLength)||((o=t.request)==null?void 0:o.response.byteLength);return H(Number(c||0))},.3);if(e&&e.byteLength>-1&&(e=q.decode(new Uint8Array(e))),e&&typeof e=="string")try{e=JSON.parse(e)}catch{}return{ResponseData:e,ResponseHeader:n,ContentSize:f}},W=t=>{if(t.response){let e=t.response.data,n=t.response.headers;if(n!=null&&n.toJSON&&(n=n.toJSON()),e&&e.byteLength>-1&&(e=q.decode(new Uint8Array(e))),e&&typeof e=="string")try{e=JSON.parse(e)}catch{}return{ResponseData:e,ResponseHeader:n}}return{ResponseData:t,ContentSize:()=>0}},Y="apiUseDoc",Z="apiAdmin",ee="ApiDocAdmin",te="swaggerAdminName";export{ee as A,Z as a,Y as b,W as c,E as d,X as e,I as f,z as g,Q as h,T as i,$ as j,v as k,V as l,M as m,te as s,U as t,K as u};
