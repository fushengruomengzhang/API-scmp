import{d as I,a as M}from"../../../resources/global/global.util.BDToHPEB.js";import{r as g}from"../../../stores/request.server.apbYzn03.js";import{G as O}from"./api/header/GlobalRequestHeader.CUz9FF07.js";import{a as b,A as B}from"./util/request.utils.CJX_gtFp.js";import{_ as F}from"../../../components/address/S3Address.Dp8cFelg.js";import{a as w,l as c,e as s,w as i,F as z,a8 as P,r as n,o as p,c as _,t as u,f as y}from"../../../.store.ssRjOe-B.js";import"../../../resources/util/map.DsJxN4sz.js";import"../../../resources/util/cache.indexeddb.CXuVJu8M.js";import"../../../resources/util/timer.util.DJ34cZ81.js";import"./api/detail/Header.ZXp1YzMC.js";import"../../../resources/util/snowflake.util.BS7FKuq4.js";import"../../../resources/util/machine.code.util.D8YEvaCo.js";import"../../../resources/util/crypto.util.C7ecaPji.js";import"../../../../../public.scmp.config.js";const j={name:"ShareIndex",components:{GlobalRequestHeader:O},setup(){const{reset:e}=g(),{isShare:t,selectEntityId:r,entityMap:d,domainOptions:o,apiDocDetail:l}=P(g());return{isShare:t,selectEntityId:r,entityMap:d,domainOptions:o,apiDocDetail:l,reset:e}},emits:[],props:{},data(){return{activeName:b,showGlobalHeader:!1,treeProps:{children:"children",isLeaf:e=>e.type==="api",label:"title"},showTooltip:!1,tooltipRef:void 0,tooltipData:{},showTooltipDebounce:M((e,t)=>{if(!e||!(t.title||t.name))return this.showTooltip=!1;this.tooltipRef=e,this.tooltipData=t,this.showTooltip=!0},.3)}},computed:{flag(){return this.$route.query.id}},watch:{},created(){this.reset(),this.isShare=!0;const e=I(this.flag,"base64").split(",");Promise.all([this.findAll("tb_request_api.find",{ids:e}),this.findOne("tb_api_docs.find",{flag:this.flag}),this.findOne("tb_config.findAll",{key:"requestEnvConfig"})]).then(([t,r,d])=>{var o;this.selectEntityId=(o=t.data[0])==null?void 0:o.id,t.data.forEach(l=>this.entityMap.put(l.id,l)),this.apiDocDetail=r.data.id?r.data:{api_ids:e,flag:this.flag},this.apiDocDetail.children=t.data,this.domainOptions=d.data.value})},mounted(){},methods:{apiDocTreeNodeOnMouseover(e,t){this.showTooltipDebounce(e.currentTarget.parentElement,t)},handleCommand(e){e==="globalRequestHeader"&&(this.showGlobalHeader=!0)},docNodeClick(e,t,r,d){if(!e)return;const o=e.type==="api";this.jumpRoute(o?b:B),o&&(this.selectEntityId=e.id)},jumpRoute(e){this.$route.name.endsWith(e)||this.$router.push({name:this.$route.meta.name+e,query:this.$route.query})}}},U={class:"layout"},L=["onMouseenter"],W=["data-text"],J={class:"tree-node-text"},K={class:"wrapper-content"},Q={style:{"white-space":"break-spaces"}};function X(e,t,r,d,o,l){const D=n("Folder"),v=n("Document"),h=n("el-icon"),k=n("el-text"),x=n("s3-tree"),N=n("s3-drag-line"),q=n("s3-scroll"),C=n("router-view"),T=n("Setting"),H=n("el-dropdown-item"),R=n("el-dropdown-menu"),G=n("el-dropdown"),V=n("s3-draggable"),E=n("el-tooltip"),S=n("global-request-header"),A=n("s3-dialog");return p(),w(z,null,[c("div",U,[s(q,{class:"api-doc-tree"},{scrollBottom:i(()=>[s(N,{"z-index":2,position:"right"})]),default:i(()=>[s(x,{class:"tree-detail","node-key":"id","highlight-current":"","default-expand-all":"","expand-on-click-node":!1,"current-node-key":d.selectEntityId,props:o.treeProps,data:[this.apiDocDetail],onNodeClick:l.docNodeClick},{default:i(({node:m,data:a})=>[c("div",{class:"node-item",onMouseenter:f=>l.apiDocTreeNodeOnMouseover(f,a),onMouseleave:t[0]||(t[0]=f=>o.showTooltipDebounce())},[a.type==="api"?(p(),w("span",{key:0,class:"api-method","data-text":a.config.method},u(a.config.method),9,W)):(p(),_(h,{key:1,class:"doc-icon"},{default:i(()=>[a.type==="folder"?(p(),_(D,{key:0})):(p(),_(v,{key:1}))]),_:2},1024)),c("div",J,[s(k,{class:"tree-node-text-wrapper",truncated:""},{default:i(()=>[y(u(a.title||a.name),1)]),_:2},1024)])],40,L)]),_:1},8,["current-node-key","props","data","onNodeClick"])]),_:1}),c("div",K,[s(C)]),s(V,{class:"setting-config"},{default:i(()=>[s(G,{trigger:"click",onCommand:l.handleCommand},{dropdown:i(()=>[s(R,null,{default:i(()=>[s(H,{command:"globalRequestHeader"},{default:i(()=>[y("全局请求头管理")]),_:1})]),_:1})]),default:i(()=>[s(h,{size:30},{default:i(()=>[s(T)]),_:1})]),_:1},8,["onCommand"])]),_:1})]),s(E,{visible:o.showTooltip,"virtual-ref":o.tooltipRef,placement:"right",effect:"customized"},{content:i(()=>[c("span",Q,u(o.tooltipData.title||o.tooltipData.desc||o.tooltipData.name),1)]),_:1},8,["visible","virtual-ref"]),s(A,{modelValue:o.showGlobalHeader,"onUpdate:modelValue":t[2]||(t[2]=m=>o.showGlobalHeader=m),title:"Global Request Header Config"},{default:i(()=>[s(S,{modelValue:o.showGlobalHeader,"onUpdate:modelValue":t[1]||(t[1]=m=>o.showGlobalHeader=m)},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}const pe=F(j,[["render",X],["__scopeId","data-v-fc2bb246"]]);export{pe as default};
