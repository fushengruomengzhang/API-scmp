import{r as T}from"../../../../stores/request.server.apbYzn03.js";import{A as F}from"./AddApiDoc.1pS0pYnG.js";import{l as I,a as z}from"../../../../resources/global/global.util.BDToHPEB.js";import{R as S}from"../api/ResponseDetail.ByklGj7k.js";import{R as U}from"../api/RequestDetail.D_vXICnH.js";import{_ as O}from"../../../../components/address/S3Address.Dp8cFelg.js";import{a8 as L,a as v,l as h,e as l,w as a,F as w,r as n,o as _,c as D,t as m,f,d as b}from"../../../../.store.ssRjOe-B.js";const j={name:"ApiDocAdmin",components:{RequestDetail:U,ResponseDetail:S,AddApiDoc:F},setup(){const{reset:t}=T(),{isShare:e,apiDetail:i,apiDocDetail:d,refreshDocTree:o}=L(T());return{reset:t,isShare:e,apiDetail:i,apiDocDetail:d,refreshDocTree:o}},emits:[],props:{},data(){return{showTooltip:!1,tooltipRef:void 0,tooltipData:{},showTooltipDebounce:z((t,e)=>{if(!t)return this.showTooltip=!1;this.tooltipRef=t,this.tooltipData=e,this.showTooltip=!0},.3),search:void 0,treeProps:{children:"children",isLeaf:t=>t.type==="api",label:"title"},edit:{visible:!1,entity:{type:"folder"}},showApiTest:!1,docData:[]}},computed:{},watch:{search(t){this.findByTitle(t)}},created(){this.reset(),this.refreshDocTree=this.onEditApiDoc},mounted(){},methods:{findByTitle(t){this.findAll("tb_api_docs.find",{search:t}).then(e=>this.docData=I(e.data))},apiDocTreeNodeOnMouseover(t,e){this.showTooltipDebounce(t.currentTarget.parentElement,e)},newChild(t,e){const i={type:e,parent_id:t.id};this.edit={entity:i,visible:!0}},showRightMenu(t,e,i){e.type!=="api"&&this.$refs.apiDocRightMenu.click(t,{node:i,entity:e})},refresh(t){this.$refs.apiDocTree.reloadNode(t)},delDoc(t,e){this.$confirm(`确定要删除[${e.title}]吗?`,"警告",{type:"warning"}).then(i=>{this.delete("tb_api_docs.delete",{id:e.id}).then(d=>{var o,r;return(r=(o=t.parent)==null?void 0:o.childNodes)==null?void 0:r.removeIf(k=>k.data.id===e.id)})}).catch(i=>{})},onEditApiDoc(t){const e=this.$refs.apiDocTree.getNode(t.id),i=e==null?void 0:e.parent;t.parent_id!==(i==null?void 0:i.data.id)&&(i==null||i.childNodes.removeIf(d=>d.data.id===t.id)),this.$refs.apiDocTree.reloadNode(t.parent_id,t.id)},editDoc(t,e){this.edit={entity:e,visible:!0}},findDocTree(t,e){t.data.type==="doc"?this.findAll("tb_request_api.find",{ids:t.data.api_ids}).then(i=>e(i.data.map(d=>({...d,_id:"api_"+d.id})))):this.findAll("tb_api_docs.find",{parentId:t.data.id??0}).then(i=>e(i.data.map(d=>({...d,_id:d.id}))))},docNodeClick(t,e,i,d){if(this.$refs.apiDocRightMenu.close(),!t)return;let o=t;t.type==="api"&&(this.apiDetail=t,o=e.parent.data,this.showApiTest=!0),o.type==="doc"&&this.apiDocDetail.id!==o.id&&(this.apiDocDetail=o)}}},G={class:"operation"},H=["onContextmenu","onMouseenter"],J=["data-text"],K={class:"tree-node-text"},Q={style:{"white-space":"break-spaces"}},W={class:"test-api-wrapper"};function X(t,e,i,d,o,r){const k=n("el-input"),C=n("el-button"),y=n("Folder"),A=n("Document"),g=n("el-icon"),R=n("el-text"),x=n("s3-tree"),V=n("s3-scroll"),N=n("el-tooltip"),M=n("add-api-doc"),u=n("el-link"),B=n("s3-right-menu"),q=n("request-detail"),E=n("response-detail"),P=n("el-drawer");return _(),v(w,null,[h("div",G,[l(k,{modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=c=>o.search=c),placeholder:"搜索(名称)",clearable:""},null,8,["modelValue"]),l(C,{class:"add-button",icon:"Plus",onClick:e[1]||(e[1]=c=>o.edit={visible:!0,entity:{type:"folder",parent_id:0}})})]),l(V,{class:"api-doc-tree"},{default:a(()=>[l(x,{class:"tree-detail","node-key":"_id","highlight-current":"",ref:"apiDocTree",data:o.docData,props:o.treeProps,lazy:"",load:r.findDocTree,onNodeClick:r.docNodeClick},{default:a(({node:c,data:s})=>[h("div",{class:"node-item",onContextmenu:p=>r.showRightMenu(p,s,c),onMouseenter:p=>r.apiDocTreeNodeOnMouseover(p,s),onMouseleave:e[2]||(e[2]=p=>o.showTooltipDebounce())},[s.type==="api"?(_(),v("span",{key:0,class:"doc-method","data-text":s.config.method},m(s.config.method),9,J)):(_(),D(g,{key:1},{default:a(()=>[s.type==="folder"?(_(),D(y,{key:0})):(_(),D(A,{key:1}))]),_:2},1024)),h("div",K,[l(R,{class:"tree-node-text-wrapper",truncated:""},{default:a(()=>[f(m(s.title||s.name),1)]),_:2},1024)])],40,H)]),_:1},8,["data","props","load","onNodeClick"])]),_:1}),l(N,{visible:o.showTooltip,"virtual-ref":o.tooltipRef,placement:"right",effect:"customized"},{content:a(()=>[h("span",Q,m(o.tooltipData.title||o.tooltipData.desc||o.tooltipData.name),1)]),_:1},8,["visible","virtual-ref"]),l(M,{modelValue:o.edit.visible,"onUpdate:modelValue":e[3]||(e[3]=c=>o.edit.visible=c),model:o.edit.entity},null,8,["modelValue","model"]),l(B,{ref:"apiDocRightMenu"},{default:a(({scope:{node:c,entity:s}})=>[s.type==="folder"?(_(),D(u,{key:0,icon:"Refresh",underline:!1,onClick:p=>r.refresh(s.id)},{default:a(()=>[f("刷新目录")]),_:2},1032,["onClick"])):b("",!0),l(u,{icon:"Edit",underline:!1,onClick:p=>r.editDoc(c,s)},{default:a(()=>[f("编辑"+m(s.type==="folder"?"目录":"文档"),1)]),_:2},1032,["onClick"]),l(u,{icon:"Delete",underline:!1,onClick:p=>r.delDoc(c,s)},{default:a(()=>[f("删除"+m(s.type==="folder"?"目录":"文档"),1)]),_:2},1032,["onClick"]),s.type==="folder"?(_(),v(w,{key:1},[l(u,{icon:"Plus",underline:!1,onClick:p=>r.newChild(s,"folder")},{default:a(()=>[f("新建子目录")]),_:2},1032,["onClick"]),l(u,{icon:"Plus",underline:!1,onClick:p=>r.newChild(s,"doc")},{default:a(()=>[f("新建子文档")]),_:2},1032,["onClick"])],64)):b("",!0)]),_:1},512),l(P,{class:"test-api",modelValue:o.showApiTest,"onUpdate:modelValue":e[4]||(e[4]=c=>o.showApiTest=c),title:d.apiDetail.name,size:"65%"},{default:a(()=>[h("div",W,[l(q),l(E)])]),_:1},8,["modelValue","title"])],64)}const se=O(j,[["render",X],["__scopeId","data-v-e768516b"]]);export{se as A};
