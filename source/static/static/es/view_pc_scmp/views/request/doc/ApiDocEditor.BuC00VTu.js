import{r as k}from"../../../../stores/request.server.Jl9Oinz8.js";import{e as B,l as x,u as A}from"../../../../resources/global/global.util.CdGU-cda.js";import{_ as I}from"../../../../components/address/S3Address.C-l0MtE3.js";import{s as U}from"../../../../pinia.C4zkjZtA.js";import{a as E,l as m,c as p,d as D,e as l,w as d,r as a,x as T,o as r,f as u,t as O,j as z}from"../../../../vue.B9VI7CMM.js";import"../../../../resources/util/map.DsJxN4sz.js";import"../../../../resources/util/cache.indexeddb.CXuVJu8M.js";import"../../../../resources/util/timer.util.DJ34cZ81.js";import"../../../../js.DlQi3gKf.js";import"../../../../md5.DCeuUgf6.js";import"../../../../charenc.DHEmDxqN.js";import"../../../../mitt.C1xD_ZTF.js";const F={name:"ApiDocEditor",components:{},setup(){const{isShare:e,apiDocDetail:i,domainOptions:o,refreshDocTree:t}=U(k());return{isShare:e,apiDocDetail:i,domainOptions:o,refreshDocTree:t}},emits:[],props:{showApiSelect:{type:Boolean,default:!0}},data(){return{cascaderProps:{value:"id",label:"title",checkStrictly:!0,emitPath:!1,lazy:!0,lazyLoad:this.findByParentId,leaf:(e,i)=>e.type==="doc",disabled:(e,i)=>e.type==="doc"},monacoConfig:{minimap:{enabled:!1},overviewRulerLanes:0,scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:4,horizontalScrollbarSize:4,handleMouseWheel:!0},stickyScroll:{enabled:!1}}}},computed:{sharePath(){const{origin:e,pathname:i}=window.location;return A(e,i)+`#/shareRequest?id=${this.apiFlag}`},disabled(){return!this.apiDocDetail.api_ids},isUp(){return!!this.apiDocDetail.id},apiFlag(){return this.apiDocDetail.flag},copyOptions(){return{getElement:e=>e.parentElement,options:{text:e=>this.sharePath},onSuccess:e=>this.$message({type:"success",showClose:!0,message:"路径已生成",center:!0})}}},watch:{},created(){},mounted(){},beforeUnmount(){},methods:{findByParentId(e,i){if(e.level===0&&(this.apiDocDetail.id||this.apiDocDetail.parent_id)){const o=[this.apiDocDetail.id,this.apiDocDetail.parent_id].filter(Boolean);this.findAll("tb_api_docs.findTreeByIdIn",{ids:o}).then(t=>i(x(t.data,"id","parent_id")))}else this.findAll("tb_api_docs.find",{parentId:e.data.id||0}).then(o=>i(o.data))},handleCommand(){},updateOrSaveApiDoc(){new Promise((e,i)=>{if(this.apiDocDetail.type!=="doc")return e([this.apiDocDetail.id?"update":"save",this.apiDocDetail,this.apiDocDetail.id?"更新成功":"新建成功"]);const o=this.apiDocDetail.flag=B(this.apiDocDetail.api_ids.sort().join(","));this.findOne("tb_api_docs.find",{flag:o}).then(t=>{if(!t.data.id)return e([this.apiDocDetail.id?"update":"save",this.apiDocDetail,this.apiDocDetail.id?"更新成功":"新建成功"]);if(this.apiDocDetail.id&&t.data.id!==this.apiDocDetail.id)return i(`该组API已关联( ${t.data.title} )`);if(this.apiDocDetail.id&&t.data.id===this.apiDocDetail.id)return e(["update",this.apiDocDetail,"更新成功"]);this.$confirm(`该组API已存在对应的使用文档( ${t.data.title} ),是否覆盖?`,"警告",{type:"warning"}).then(s=>Promise.resolve(this.apiDocDetail.id=s.data.id)).then(s=>e(["update",this.apiDocDetail,"更新成功"])).catch(s=>{})})}).then(([e,i,o])=>{(e==="update"?this.update("tb_api_docs.update",i):this.save("tb_api_docs.save",i)).then(s=>{this.$message({type:"success",showClose:!0,message:o,center:!0}),e==="save"&&(this.apiDocDetail.id=s.data),this.refreshDocTree(this.apiDocDetail),this.showForm=!1})}).catch(e=>this.$message({type:"warning",showClose:!0,message:e,center:!0}))}}},L={class:"api-doc"},N={class:"api-doc-top"},R={class:"operation"},j={class:"editor-wrapper"};function q(e,i,o,t,s,n){const _=a("el-cascader"),f=a("el-input"),y=a("Edit"),w=a("Plus"),h=a("el-icon"),b=a("Share"),v=a("el-text"),g=a("el-dropdown-item"),S=a("el-dropdown-menu"),C=a("el-dropdown"),P=a("s3-monaco-editor"),V=T("copy");return r(),E("div",L,[m("div",N,[t.isShare?D("",!0):(r(),p(_,{class:"doc-folder",placeholder:"请选择目录",key:t.apiDocDetail.id,modelValue:t.apiDocDetail.parent_id,"onUpdate:modelValue":i[0]||(i[0]=c=>t.apiDocDetail.parent_id=c),props:s.cascaderProps},null,8,["modelValue","props"])),m("div",R,[l(f,{class:"doc-title",disabled:t.isShare,placeholder:"请输入名称",modelValue:t.apiDocDetail.title,"onUpdate:modelValue":i[1]||(i[1]=c=>t.apiDocDetail.title=c)},null,8,["disabled","modelValue"]),t.isShare?D("",!0):(r(),p(C,{key:0,class:"operation-dropdown",disabled:n.disabled,"split-button":"",type:"primary",onCommand:n.handleCommand,onClick:n.updateOrSaveApiDoc},{dropdown:d(()=>[l(S,null,{default:d(()=>[l(g,{disabled:!n.isUp,command:"shareDocument"},{default:d(()=>[z((r(),p(v,null,{default:d(()=>[l(h,null,{default:d(()=>[l(b)]),_:1}),u("分享文档")]),_:1})),[[V,n.copyOptions]])]),_:1},8,["disabled"])]),_:1})]),default:d(()=>[l(h,null,{default:d(()=>[n.isUp?(r(),p(y,{key:0})):(r(),p(w,{key:1}))]),_:1}),u(O(n.isUp?"更新":"新建")+" ",1)]),_:1},8,["disabled","onCommand","onClick"]))])]),m("div",j,[l(P,{modelValue:t.apiDocDetail.content,"onUpdate:modelValue":i[2]||(i[2]=c=>t.apiDocDetail.content=c),config:s.monacoConfig},null,8,["modelValue","config"])])])}const te=I(F,[["render",q],["__scopeId","data-v-f4f16ef8"]]);export{te as default};
