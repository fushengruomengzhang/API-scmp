import{r as P}from"../../../../stores/request.server.OPoUfqQ8.js";import{A as F}from"./AddApiDoc.e506zN4v.js";import{l as z,a as S}from"../../../../resources/global/global.util.CrvsVFo3.js";import{R as U}from"../api/ResponseDetail.cqpkDBqS.js";import{R as O}from"../api/RequestDetail.BykTnGZq.js";import{s as T}from"../../../../resources/util/snowflake.util.C4QYlgiq.js";import{_ as L}from"../../../../components/address/S3Address.BvGSUWFm.js";import{s as j}from"../../../../pinia.DPawhP_y.js";import{a as v,l as m,e as l,w as r,F as w,r as n,o as f,c as D,t as h,f as _,d as C}from"../../../../vue.CpRb0aFL.js";const G={name:"ApiDocAdmin",components:{RequestDetail:O,ResponseDetail:U,AddApiDoc:F},setup(){const{isShare:e,apiDetail:t,apiDocDetail:i,refreshDocTree:a}=j(P());return{isShare:e,apiDetail:t,apiDocDetail:i,refreshDocTree:a}},emits:[],props:{},data(){return{showTooltip:!1,tooltipRef:void 0,tooltipData:{},showTooltipDebounce:S((e,t)=>{if(!e)return this.showTooltip=!1;this.tooltipRef=e,this.tooltipData=t,this.showTooltip=!0},.3),search:void 0,treeProps:{children:"children",isLeaf:e=>e.type==="api",label:"title"},edit:{visible:!1,entity:{type:"folder"}},showApiTest:!1,docData:[]}},computed:{},watch:{search(e){this.findByTitle(e)}},created(){this.refreshDocTree=this.onEditApiDoc},mounted(){},methods:{findByTitle(e){this.findAll("tb_api_docs.find",{search:e}).then(t=>this.docData=z(t.data))},apiDocTreeNodeOnMouseover(e,t){this.showTooltipDebounce(e.currentTarget.parentElement,t)},newChild(e,t){const i={type:t,parent_id:e.id};this.edit={entity:i,visible:!0}},showRightMenu(e,t,i){t.type!=="api"&&this.$refs.apiDocRightMenu.click(e,{node:i,entity:t})},refresh(e){this.$refs.apiDocTree.reloadNode(e)},delDoc(e,t){this.$confirm(`确定要删除[${t.title}]吗?`,"警告",{type:"warning"}).then(i=>{this.delete("tb_api_docs.delete",{id:t.id}).then(a=>{var o,d;return(d=(o=e.parent)==null?void 0:o.childNodes)==null?void 0:d.removeIf(k=>k.data.id===t.id)})}).catch(i=>{})},onEditApiDoc(e){e.id===this.apiDocDetail.id&&(this.apiDocDetail={...e});const t=this.$refs.apiDocTree.getNode(e.id),i=t==null?void 0:t.parent;e.parent_id!==(i==null?void 0:i.data.id)&&(i==null||i.childNodes.removeIf(a=>a.data.id===e.id)),this.$refs.apiDocTree.reloadNode(e.parent_id,e.id)},editDoc(e,t){this.edit={entity:t,visible:!0}},findDocTree(e,t){e.data.type==="doc"?this.findAll("tb_request_api.find",{ids:e.data.api_ids}).then(i=>t(i.data.map(a=>({...a,_id:T()})))):this.findAll("tb_api_docs.find",{parentId:e.data.id??0}).then(i=>t(i.data.map(a=>({...a,_id:T()}))))},docNodeClick(e,t,i,a){if(this.$refs.apiDocRightMenu.close(),!e)return;let o=e;e.type==="api"&&(this.apiDetail=e,o=t.parent.data,this.showApiTest=!0),o.type==="doc"&&this.apiDocDetail.id!==o.id&&(this.apiDocDetail=o)}}},H={class:"operation"},J=["onContextmenu","onMouseenter"],K=["data-text"],Q={class:"tree-node-text"},W={style:{"white-space":"break-spaces"}},X={class:"test-api-wrapper"};function Y(e,t,i,a,o,d){const k=n("el-input"),b=n("el-button"),A=n("Folder"),g=n("Document"),y=n("el-icon"),R=n("el-text"),x=n("s3-tree"),V=n("s3-scroll"),N=n("el-tooltip"),M=n("add-api-doc"),u=n("el-link"),B=n("s3-right-menu"),q=n("request-detail"),E=n("response-detail"),I=n("el-drawer");return f(),v(w,null,[m("div",H,[l(k,{modelValue:o.search,"onUpdate:modelValue":t[0]||(t[0]=c=>o.search=c),placeholder:"搜索(名称)",clearable:""},null,8,["modelValue"]),l(b,{class:"add-button",icon:"Plus",onClick:t[1]||(t[1]=c=>o.edit={visible:!0,entity:{type:"folder",parent_id:0}})})]),l(V,{class:"api-doc-tree"},{default:r(()=>[l(x,{class:"tree-detail","node-key":"_id","highlight-current":"",ref:"apiDocTree",data:o.docData,props:o.treeProps,lazy:"",load:d.findDocTree,onNodeClick:d.docNodeClick},{default:r(({node:c,data:s})=>[m("div",{class:"node-item",onContextmenu:p=>d.showRightMenu(p,s,c),onMouseenter:p=>d.apiDocTreeNodeOnMouseover(p,s),onMouseleave:t[2]||(t[2]=p=>o.showTooltipDebounce())},[s.type==="api"?(f(),v("span",{key:0,class:"doc-method","data-text":s.config.method},h(s.config.method),9,K)):(f(),D(y,{key:1},{default:r(()=>[s.type==="folder"?(f(),D(A,{key:0})):(f(),D(g,{key:1}))]),_:2},1024)),m("div",Q,[l(R,{class:"tree-node-text-wrapper",truncated:""},{default:r(()=>[_(h(s.title||s.name),1)]),_:2},1024)])],40,J)]),_:1},8,["data","props","load","onNodeClick"])]),_:1}),l(N,{visible:o.showTooltip,"virtual-ref":o.tooltipRef,placement:"right",effect:"customized"},{content:r(()=>[m("span",W,h(o.tooltipData.title||o.tooltipData.desc||o.tooltipData.name),1)]),_:1},8,["visible","virtual-ref"]),l(M,{modelValue:o.edit.visible,"onUpdate:modelValue":t[3]||(t[3]=c=>o.edit.visible=c),model:o.edit.entity},null,8,["modelValue","model"]),l(B,{ref:"apiDocRightMenu"},{default:r(({scope:{node:c,entity:s}})=>[s.type==="folder"?(f(),D(u,{key:0,icon:"Refresh",underline:!1,onClick:p=>d.refresh(s.id)},{default:r(()=>[_("刷新目录")]),_:2},1032,["onClick"])):C("",!0),l(u,{icon:"Edit",underline:!1,onClick:p=>d.editDoc(c,s)},{default:r(()=>[_("编辑"+h(s.type==="folder"?"目录":"文档"),1)]),_:2},1032,["onClick"]),l(u,{icon:"Delete",underline:!1,onClick:p=>d.delDoc(c,s)},{default:r(()=>[_("删除"+h(s.type==="folder"?"目录":"文档"),1)]),_:2},1032,["onClick"]),s.type==="folder"?(f(),v(w,{key:1},[l(u,{icon:"Plus",underline:!1,onClick:p=>d.newChild(s,"folder")},{default:r(()=>[_("新建子目录")]),_:2},1032,["onClick"]),l(u,{icon:"Plus",underline:!1,onClick:p=>d.newChild(s,"doc")},{default:r(()=>[_("新建子文档")]),_:2},1032,["onClick"])],64)):C("",!0)]),_:1},512),l(I,{class:"test-api",modelValue:o.showApiTest,"onUpdate:modelValue":t[4]||(t[4]=c=>o.showApiTest=c),title:a.apiDetail.name,size:"65%"},{default:r(()=>[m("div",X,[l(q),l(E)])]),_:1},8,["modelValue","title"])],64)}const de=L(G,[["render",Y],["__scopeId","data-v-d7873d37"]]);export{de as A};
