import{a as g}from"../../axios.mzEGo-1q.js";import{C as v}from"../../clipboard.CwJjsxQO.js";import{a as E,b as $}from"../util/crypto.util.De05Bpu1.js";import{s as C}from"../util/snowflake.util.CMOmz3k-.js";const S=(t,o,n,s)=>{const a=e=>(o(e.headers),t.config.globalProperties.$decryEncryAttempt?e.decryEncryAttempt||(e.headers["Content-Type"]="application/json",e.data&&(e.data=[E(JSON.stringify(e.data),e.url)])):e.headers["Attempt-Decry-Encry"]="Base64",e),u=e=>{if(e.headers["content-disposition"])return e;if(t.config.globalProperties.$decryEncryAttempt&&e.headers["content-type"]==="application/octet-stream;application/json")try{e.data=JSON.parse($(e.data,e.config.url))}catch{}const c=e,i=e.data;return c._data=e.data,e.data instanceof ArrayBuffer||e.data instanceof Blob||Object.keys(e.data).forEach(r=>c[r]=i[r]),c},f=e=>(n(e),Promise.reject(e)),p=e=>{if(!e.response||!e.config)return s(e),Promise.reject(e);const{response:c,config:{method:i,url:r,data:l}}=e;if(!c)return console.table({method:i,url:r,data:l}),Promise.reject(`error ${i} ${r}`);const{status:d,data:{msg:y,stack:m,stackMsg:h}}=c;return m&&(console.groupCollapsed(h),console.groupCollapsed(`request detail: ${d} ${i} ${r}`),console.log(`params: ${l}`),console.log(`message: ${y}`),console.groupEnd(),m.forEach(b=>console.info(b)),console.groupEnd()),d===401&&t.config.globalProperties.$cache.clear(),s(e,d),Promise.reject(e)};g.interceptors.request.use(a,f),g.interceptors.response.use(u,p),t.config.globalProperties.$axios=g},P=t=>{t.config.globalProperties.$cache={get:o=>localStorage.get(o),set:(o,n)=>localStorage.set(o,n),remove:o=>localStorage.removeItem(o),clear:()=>localStorage.clear()}},j=(t,o)=>{t.directive("auth",{mounted(s,a,u){a.value&&!o(a.value)&&s.parentNode.removeChild(s)}});const n={};t.directive("copy",{mounted(s,a,u,f){const{groupId:p,getElement:e,options:c,onSuccess:i,onError:r}=a.value,l=p||C("copy"),d=e?e(s):s;d.setAttribute("copy-flag",l),n[l]?n[l].listenClick(d):n[l]=new v(d,c).on("success",i).on("error",r)},unmounted(s,a,u,f){var p;(p=n[s.getAttribute("copy-flag")])==null||p.destroy()}})},A=()=>{const t=screen.width>=1440?screen.width:1440;let o=t<=1440?10:t<=1920?12:15;const n=[`--inner-width:${t}px;`,`--body-font-size:${o}px`];document.documentElement.setAttribute("style",n.join(";"))},I={install:(t,{setHeader:o,onReqErr:n,onResErr:s,checkAuth:a})=>{A(),P(t),j(t,a),S(t,o,n,s)}};export{I as p};
