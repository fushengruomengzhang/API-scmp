import{a as g}from"../../axios.mzEGo-1q.js";import{C as v}from"../../clipboard.CwJjsxQO.js";import{a as E,b as $}from"../util/crypto.util.Cg1BRL9K.js";import{s as C}from"../util/snowflake.util.C4QYlgiq.js";const S=(t,o,s,n)=>{const a=e=>(o(e.headers),t.config.globalProperties.$decryEncryAttempt?e.decryEncryAttempt||(e.headers["Content-Type"]="application/json",e.data&&(e.data=[E(JSON.stringify(e.data),e.url)])):e.headers["Attempt-Decry-Encry"]="Base64",e),u=e=>{if(e.headers["content-disposition"])return e;if(t.config.globalProperties.$decryEncryAttempt&&e.headers["content-type"]==="application/octet-stream;application/json")try{e.data=JSON.parse($(e.data,e.config.url))}catch{}const c=e,i=e.data;return c._data=e.data,e.data instanceof ArrayBuffer||e.data instanceof Blob||Object.keys(e.data).forEach(r=>c[r]=i[r]),c},f=e=>(s(e),Promise.reject(e)),d=e=>{if(!e.response||!e.config)return n(e),Promise.reject(e);const{response:c,config:{method:i,url:r,data:l}}=e;if(!c)return console.table({method:i,url:r,data:l}),Promise.reject(`error ${i} ${r}`);const{status:p,data:{msg:y,stack:m,stackMsg:h}}=c;return m&&(console.groupCollapsed(h),console.groupCollapsed(`request detail: ${p} ${i} ${r}`),console.log(`params: ${l}`),console.log(`message: ${y}`),console.groupEnd(),m.forEach(b=>console.info(b)),console.groupEnd()),p===401&&t.config.globalProperties.$cache.clear(),n(e,p),Promise.reject(e)};g.interceptors.request.use(a,f),g.interceptors.response.use(u,d),t.config.globalProperties.$axios=g},P=t=>{t.config.globalProperties.$cache={get:o=>localStorage.get(o),set:(o,s)=>localStorage.set(o,s),remove:o=>localStorage.removeItem(o),clear:()=>localStorage.clear()}},j=(t,o)=>{t.directive("auth",{mounted(n,a,u){a.value&&!o(a.value)&&n.parentNode.removeChild(n)}});const s={};t.directive("copy",{mounted(n,a,u,f){const{groupId:d,getElement:e,options:c,onSuccess:i,onError:r}=a.value,l=d||C("copyFlag");n.setAttribute("copy-flag",l);const p=e?e(n):n;s[l]?s[l].listenClick(p):s[l]=new v(p,c).on("success",i).on("error",r)},unmounted(n,a,u,f){var d;(d=s[n.getAttribute("copy-flag")])==null||d.destroy()}})},A=()=>{const t=screen.width>=1440?screen.width:1440;let o=t<=1440?10:t<=1920?12:15;const s=[`--inner-width:${t}px;`,`--body-font-size:${o}px`];document.documentElement.setAttribute("style",s.join(";"))},I={install:(t,{setHeader:o,onReqErr:s,onResErr:n,checkAuth:a})=>{A(),P(t),j(t,a),S(t,o,s,n)}};export{I as p};
