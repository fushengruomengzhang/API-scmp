class h{constructor({locale:t,defaultLocale:e,messages:s,languages:a,ignoreClass:i}){this._locale=t,this.defaultLocale=e,this.messages=s,this.languages=a,this.ignoreClass=i||"ignore_i18n",this.ignoreSelectors=`.${this.ignoreClass}`,this.languageNames=Object.keys(a),this.config=s[t],this.configEmpty=this.config===void 0,this.cache={attribute:{},text:{}},this.observer=new MutationObserver(r=>this.mutationCallback(r)),this.observer.observe(document.documentElement,{childList:!0,attributes:!0,subtree:!0,characterData:!0})}mutationCallback(t){this._locale!==this.defaultLocale&&t.forEach(e=>{switch(e.type){case"attributes":this.translate(e.target,"attributes");break;case"childList":this.translate(Array.from(e.addedNodes),"childList");break;case"subtree":break;case"characterData":this.translate(e.target,"characterData");break}})}ignoreI18n(t){var e,s;return(e=t.classList)!=null&&e.contains(this.ignoreClass)?!0:t.closest?!!t.closest(this.ignoreSelectors):!!((s=t.parent||t.parentNode)!=null&&s.closest(this.ignoreSelectors))}translate(t,e){const s=i=>i.nodeType!==Node.COMMENT_NODE&&["script","style","link"].indexOf(i.nodeName.toLowerCase())===-1;let a=(t instanceof Array?t:[t]).filter(i=>i instanceof Element);for(let i of a){const r=document.createTreeWalker(i,NodeFilter.SHOW_ALL,{acceptNode:s});for(;r.nextNode();){const n=r.currentNode;this.ignoreI18n(n)||(n.nodeType!==Node.TEXT_NODE&&this.translateAttribute(n),!(e==="attributes"||!n.nodeValue)&&this.translateText(n))}}}translateAttribute(t){const e=t.getAttributeNames();for(let s of e){const a=t.getAttribute(s);if(this.configEmpty)this.cache.attribute[a]&&t.setAttribute(s,this.cache.attribute[a]);else{const i=this.getResult(a);i&&(t.setAttribute(s,i),this.cache.attribute[i]||(this.cache.attribute[i]=a))}}}translateText(t){const e=t.nodeValue;if(this.configEmpty)this.cache.text[e]&&(t.nodeValue=this.cache.text[e]);else{const s=this.cache.text[e]||t.nodeValue,a=new RegExp(`(\\s*)(${s.trim()})(\\s*)`),i=s.replace(a,(r,n,c,o)=>!c||(c=this.getResult(c),!c)?"":`${n}${c}${o}`);i&&(t.nodeValue=i,this.cache.text[i]||(this.cache.text[i]=e))}}getResult(t){if(this.config instanceof Function)return this.config(t,this.defaultLocale,this._locale);if(this.config instanceof Object)return this.config[t]}get locale(){return this._locale}set locale(t){this.defaultLocale=this._locale,this._locale=t,this.config=this.messages[t],this.configEmpty=this.config===void 0,this.translate(document.documentElement,"switchLanguage")}getLanguageName(){return this.languages[this.locale]}}const u=l=>({install:(t,e)=>{e||console.warn("需要将vue3的api[reactive]作为option传递进来"),window.i18n=t.config.globalProperties.$i18n=e(new h(l))}});export{u as c};
