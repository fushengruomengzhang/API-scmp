import{S as V}from"./item/S3ColumnSlot.D5YUb471.js";import{S as E}from"./item/S3Column.CPkiUy1i.js";import{S as A}from"./item/S3ColumnHeader.C0c9MS4T.js";import{S as U}from"./item/S3ColumnHeaderSlot.BlP0e75I.js";import{_ as F}from"../address/S3Address.C-l0MtE3.js";import{r as u,x as I,c as h,o as l,w as n,d as p,e as c,b as r,l as y,j as L,m as f,a as b,F as S,h as C,k as w,n as k,g as M,f as q,t as z}from"../../vue.B9VI7CMM.js";import"../../mitt.C1xD_ZTF.js";const G={name:"S3Table",extends:{},mixins:[],components:{S3ColumnHeaderSlot:U,S3ColumnHeader:A,S3Column:E,S3ColumnSlot:V},props:{columns:{type:Array},buttonColumn:{type:Object,default:()=>({align:"center",width:"100"})},db:{type:Object,default:()=>({pageSize:10,pageNumber:1,total:0,data:[]})},params:{type:Object,default:()=>{}},direction:{type:String,default:"rtl"},loading:{type:Boolean,default:!1},defaultSelectionKey:{type:Array,default:()=>[]}},emits:["callback","update:loading","selection-change"],watch:{defaultSelectionKey:{deep:!0,handler(e,o){this.toggleRowSelection(!0,a=>this.defaultSelectionKey.includes(a[this.$attrs["row-key"]]))}}},computed:{useSearchHeader(){return this.$slots.searchHeader!==void 0},usePage(){return this.params&&this.params.pageSize&&this.params.pageNumber},useButton(){return this.$slots.buttons!==void 0||this.buttonColumn.header&&this.$slots[this.buttonColumn.header]},useDrawer(){return this.$slots.otherDefault!==void 0},customSlotsKey(){return Object.keys(this.$slots).filter(e=>this.defaultSlotsKey.indexOf(e)===-1)}},data(){return{defaultSlotsKey:["searchHeader","buttons","otherHeader","otherDefault","otherDefaultButton","otherFooter"],showDrawer:!1,pageSizes:[1,5,10,15,20,25,30,35,40,45,50],selectionChangeRun:!0}},mounted(){this.defaultSelectionKey&&this.defaultSelectionKey.length&&this.toggleRowSelection(!0,e=>this.defaultSelectionKey.includes(e[this.$attrs["row-key"]]))},methods:{currentChange(e){this.params.pageSize=this.db.pageSize,this.params.pageNumber=e,this.$emit("update:loading",!0),this.$emit("callback",this.params)},sizeChange(e){this.params.pageSize=e,this.params.pageNumber=this.db.pageNumber,this.$emit("update:loading",!0),this.$emit("callback",this.params)},onSelectionChange(e){this.selectionChangeRun&&this.$emit("selection-change",e)},toggleRowSelection(e,o){this.selectionChangeRun=!1,this.$nextTick(()=>{if(!(o instanceof Function))o instanceof Array?o.forEach(a=>this.$refs.elTable.toggleRowSelection(a,e,!1)):this.$refs.elTable.toggleRowSelection(o,e,!1);else{const{children:a}=this.$attrs["tree-props"]||this.$attrs.treeProps||{};if(!a)this.db.data.filter(o).forEach(g=>this.$refs.elTable.toggleRowSelection(g,e,!1));else{const g=m=>{m.forEach(s=>{o(s)&&this.$refs.elTable.toggleRowSelection(s,e,!1);const d=s[a];d&&d.length&&g(d)})};g(this.db.data)}}this.selectionChangeRun=!0})},getSelectionRows(){return this.$refs.elTable.getSelectionRows()}}},J={class:"table_body_wrapper"},O={key:1},Q={class:"other_header_wrapper"};function W(e,o,a,g,m,s){const _=u("el-col"),d=u("el-row"),D=u("s3-column-header-slot"),R=u("s3-column-header"),v=u("s3-column-slot"),N=u("s3-column"),$=u("el-button"),H=u("el-table-column"),K=u("el-table"),T=u("el-drawer"),B=u("el-pagination"),j=I("loading");return l(),h(d,{class:"table_v1"},{default:n(()=>[s.useSearchHeader?(l(),h(d,{key:0,class:"table_header"},{default:n(()=>[c(_,{span:24,class:"table_header_wrapper"},{default:n(()=>[r(e.$slots,"searchHeader",{},void 0,!0)]),_:3})]),_:3})):p("",!0),c(d,{class:"table_body"},{default:n(()=>[y("div",J,[L((l(),h(K,f({ref:"elTable",data:a.db.data||e.$attrs.data},e.$attrs,{"element-loading-text":"加载中...",onSelectionChange:s.onSelectionChange,"max-height":"100%",height:"100%",border:"","highlight-current-row":""}),{default:n(()=>[(l(!0),b(S,null,C(a.columns,t=>(l(),b(S,null,[t.header&&t.slot?(l(),h(D,{key:0,column:t},{[t.header]:n(i=>[r(e.$slots,t.header,f({ref_for:!0},i),void 0,!0)]),[t.slot]:n(i=>[r(e.$slots,t.slot,f({ref_for:!0},i),void 0,!0)]),_:2},1032,["column"])):t.header?(l(),h(R,{key:1,column:t},{[t.header]:n(i=>[r(e.$slots,t.header,f({ref_for:!0},i),void 0,!0)]),_:2},1032,["column"])):t.slot?(l(),h(v,{key:2,column:t},{[t.slot]:n(i=>[r(e.$slots,t.slot,f({ref_for:!0},i),void 0,!0)]),_:2},1032,["column"])):(l(),h(N,{key:3,column:t},w({_:2},[C(s.customSlotsKey,i=>({name:i,fn:n(P=>[r(e.$slots,i,f({ref_for:!0},P),void 0,!0)])}))]),1032,["column"]))],64))),256)),s.useButton?(l(),h(H,f({key:0},a.buttonColumn,{align:a.buttonColumn.align||"center"}),{header:n(t=>[a.buttonColumn.header?r(e.$slots,a.buttonColumn.header,k(f({key:0},t)),void 0,!0):(l(),b(S,{key:1},[s.useDrawer?(l(),h($,{key:0,text:"",type:"primary",size:"small",icon:"MoreFilled",onClick:o[0]||(o[0]=i=>m.showDrawer=!0)},{default:n(()=>[q(z(a.buttonColumn.label!==void 0?a.buttonColumn.label:"其他操作"),1)]),_:1})):(l(),b("span",O,z(a.buttonColumn.label!==void 0?a.buttonColumn.label:"操作"),1))],64))]),default:n(t=>[r(e.$slots,"buttons",k(M(t)),void 0,!0)]),_:3},16,["align"])):p("",!0)]),_:3},16,["data","onSelectionChange"])),[[j,a.loading]]),c(T,{class:"drawer-to-parent",modelValue:m.showDrawer,"onUpdate:modelValue":o[1]||(o[1]=t=>m.showDrawer=t),size:"40%",title:"其他操作",direction:a.direction,"lock-scroll":!1},w({default:n(()=>[c(d,null,{default:n(()=>[c(_,{span:24},{default:n(()=>[r(e.$slots,"otherDefault",{},void 0,!0)]),_:3}),c(_,{span:24},{default:n(()=>[c(d,{justify:"end"},{default:n(()=>[r(e.$slots,"otherDefaultButton",{},void 0,!0)]),_:3})]),_:3})]),_:3})]),footer:n(()=>[r(e.$slots,"otherFooter",{},void 0,!0)]),_:2},[e.$slots.otherHeader!==void 0?{name:"header",fn:n(()=>[y("div",Q,[r(e.$slots,"otherHeader",{},void 0,!0)])]),key:"0"}:void 0]),1032,["modelValue","direction"])])]),_:3}),s.usePage?(l(),h(d,{key:1,class:"table_footer"},{default:n(()=>[c(B,{background:"",layout:"total,prev,pager,next,jumper,sizes","page-sizes":m.pageSizes,total:a.db.total||1,"page-size":a.db.pageSize,"onUpdate:pageSize":o[2]||(o[2]=t=>a.db.pageSize=t),"current-page":a.db.pageNumber,"onUpdate:currentPage":o[3]||(o[3]=t=>a.db.pageNumber=t),onSizeChange:s.sizeChange,onCurrentChange:s.currentChange},null,8,["page-sizes","total","page-size","current-page","onSizeChange","onCurrentChange"])]),_:1})):p("",!0)]),_:3})}const ne=F(G,[["render",W],["__scopeId","data-v-0c7749f7"]]);export{ne as default};
