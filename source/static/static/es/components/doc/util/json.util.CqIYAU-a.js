function S(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function k(e){if(typeof Array.prototype.flat=="function")return e.flat();const s=[...e],t=[];for(;s.length;){const n=s.shift();Array.isArray(n)?s.unshift(...n):t.push(n)}return t}function d(e,s="root",t=0){const n=[];for(const o in e){if(!e.hasOwnProperty(o)||o.startsWith("@_"))continue;const a=e[o];if(Array.isArray(a))a.forEach((r,p)=>{const i=`${s}.${o}[${p}]`,l=g(r);$(r)?n.push({keyStart:"<",keyEnd:"/>",key:o,properties:f(r),level:t,path:i,id:`${i}_selfclose`,type:"elementSelfClose"}):(n.push({keyStart:"<",keyEnd:">",key:o,properties:f(r),level:t,path:i,id:`${i}_start`,type:"elementStart",length:l}),n.push(...d(r,i,t+1)),n.push({key:`</${o}>`,level:t,path:i,id:`${i}_end`,type:"elementEnd"}))});else if(typeof a=="object"&&a!==null){const r=`${s}.${o}`,p=g(a);$(a)?n.push({keyStart:"<",keyEnd:"/>",key:o,properties:f(a),level:t,path:r,id:`${r}_selfclose`,type:"elementSelfClose"}):(n.push({keyStart:"<",keyEnd:">",key:o,properties:f(a),level:t,path:r,id:`${r}_start`,type:"elementStart",length:p}),n.push(...d(a,r,t+1)),n.push({key:`</${o}>`,level:t,path:r,id:`${r}_end`,type:"elementEnd"}))}else{const r=`${s}.${o}`;$(a)?n.push({keyStart:"<",keyEnd:"/>",key:o,properties:f(a),level:t,path:r,id:`${r}_selfclose`,type:"elementSelfClose"}):(n.push({key:`<${o}>`,level:t,path:r,id:`${r}_start`,type:"elementStart"}),n.push({content:a,level:t+1,path:`${r}._text`,id:`${r}._text`,type:S(a)}),n.push({key:`</${o}>`,level:t,path:r,id:`${r}_end`,type:"elementEnd"}))}}return n}function g(e){return typeof e!="object"||e===null?0:Object.keys(e).filter(s=>!s.startsWith("@_")).flatMap(s=>e[s]).length}function $(e){return e===""?!0:typeof e!="object"||e===null?!1:Object.keys(e).filter(t=>!t.startsWith("@_")).length===0}function f(e){if(typeof e!="object"||e===null)return;const s=Object.entries(e).filter(([t])=>t.startsWith("@_")).map(([t,n])=>({k:t.slice(2),v:n}));return s.length>0?s:void 0}function u(e,s="root",t=0,n={}){const{key:o,index:a,type:r,showComma:p=!1,length:i=1}=n,l=S(e);if(l==="array"){const y=k((e||[]).map((h,c,m)=>u(h,`${s}[${c}]`,t+1,{index:c,showComma:c!==m.length-1,length:i,type:r})));return[u("[",s,t,{showComma:!1,key:o,length:(e||[]).length,type:"arrayStart"})[0]].concat(y,u("]",s,t,{showComma:p,length:(e||[]).length,type:"arrayEnd"})[0])}else if(l==="object"){const y=Object.keys(e||{}),h=k(y.map((c,m,_)=>u((e||{})[c],/^[a-zA-Z_]\w*$/.test(c)?`${s}.${c}`:`${s}["${c}"]`,t+1,{key:c,showComma:m!==_.length-1,length:i,type:r})));return[u("{",s,t,{showComma:!1,key:o,index:a,length:y.length,type:"objectStart"})[0]].concat(h,u("}",s,t,{showComma:p,length:y.length,type:"objectEnd"})[0])}return[{content:e,level:t,key:o,index:a,path:s,showComma:p,length:i,type:r||l,id:[s,r].join("_")}]}function C(e,s){return s.reduce(function(t,n){return n.level>=e&&(n.type==="objectStart"||n.type==="arrayStart"||n.type==="elementStart")&&(t[n.path]=!0),t},{})}function b(e,s){let t=null;const n=[];for(let o=0;o<e.length;o++){const a={...e[o],_index:o},r=s[a.path];if(t&&t.path===a.path){const p=t.type==="objectStart",i=t.type==="elementStart",l={...a,...t,showComma:a.showComma,content:i?`...${a.key}`:p?"{...}":"[...]",type:i?"xmlCollapsed":p?"objectCollapsed":"arrayCollapsed"};t=null,n.push(l)}else r&&!t?t=a:t||n.push(a)}return n}export{b as c,C as i,u as j,d as x};
